<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Karatsuba</title><link rel="stylesheet" href="Agda.css"></head><body><pre class="Agda"><a id="1" class="Symbol">{-#</a> <a id="5" class="Keyword">OPTIONS</a> <a id="13" class="Pragma">--cubical</a> <a id="23" class="Pragma">--postfix-projections</a> <a id="45" class="Symbol">#-}</a>

<a id="50" class="Keyword">module</a> <a id="57" href="Karatsuba.html" class="Module">Karatsuba</a> <a id="67" class="Keyword">where</a>

<a id="74" class="Keyword">open</a> <a id="79" class="Keyword">import</a> <a id="86" href="Prelude.html" class="Module">Prelude</a>
<a id="94" class="Keyword">open</a> <a id="99" class="Keyword">import</a> <a id="106" href="Data.List.html" class="Module">Data.List</a>
<a id="116" class="Keyword">open</a> <a id="121" class="Keyword">import</a> <a id="128" href="TreeFold.html" class="Module">TreeFold</a>
<a id="137" class="Keyword">open</a> <a id="142" class="Keyword">import</a> <a id="149" href="Data.Integer.html" class="Module">Data.Integer</a>
<a id="162" class="Keyword">open</a> <a id="167" class="Keyword">import</a> <a id="174" href="Data.Integer.Literals.html" class="Module">Data.Integer.Literals</a>
<a id="196" class="Keyword">open</a> <a id="201" class="Keyword">import</a> <a id="208" href="Data.Nat.Literals.html" class="Module">Data.Nat.Literals</a>
<a id="226" class="Keyword">import</a> <a id="233" href="Data.Nat.html" class="Module">Data.Nat</a> <a id="242" class="Symbol">as</a> <a id="245" class="Module">ℕ</a>
<a id="247" class="Keyword">open</a> <a id="252" class="Keyword">import</a> <a id="259" href="Literals.Number.html" class="Module">Literals.Number</a>

<a id="276" class="Keyword">data</a> <a id="Tree"></a><a id="281" href="Karatsuba.html#281" class="Datatype">Tree</a> <a id="286" class="Symbol">{</a><a id="287" href="Karatsuba.html#287" class="Bound">a</a><a id="288" class="Symbol">}</a> <a id="290" class="Symbol">(</a><a id="291" href="Karatsuba.html#291" class="Bound">A</a> <a id="293" class="Symbol">:</a> <a id="295" href="Level.html#192" class="Function">Type</a> <a id="300" href="Karatsuba.html#287" class="Bound">a</a><a id="301" class="Symbol">)</a> <a id="303" class="Symbol">:</a> <a id="305" href="Level.html#192" class="Function">Type</a> <a id="310" href="Karatsuba.html#287" class="Bound">a</a> <a id="312" class="Keyword">where</a>
  <a id="Tree.empt"></a><a id="320" href="Karatsuba.html#320" class="InductiveConstructor">empt</a> <a id="325" class="Symbol">:</a> <a id="327" href="Karatsuba.html#281" class="Datatype">Tree</a> <a id="332" href="Karatsuba.html#291" class="Bound">A</a>
  <a id="Tree.leaf"></a><a id="336" href="Karatsuba.html#336" class="InductiveConstructor">leaf</a> <a id="341" class="Symbol">:</a> <a id="343" href="Karatsuba.html#291" class="Bound">A</a> <a id="345" class="Symbol">→</a> <a id="347" href="Karatsuba.html#281" class="Datatype">Tree</a> <a id="352" href="Karatsuba.html#291" class="Bound">A</a>
  <a id="Tree._⊗_"></a><a id="356" href="Karatsuba.html#356" class="InductiveConstructor Operator">_⊗_</a> <a id="360" class="Symbol">:</a> <a id="362" href="Karatsuba.html#281" class="Datatype">Tree</a> <a id="367" href="Karatsuba.html#291" class="Bound">A</a> <a id="369" class="Symbol">→</a> <a id="371" href="Karatsuba.html#281" class="Datatype">Tree</a> <a id="376" href="Karatsuba.html#291" class="Bound">A</a> <a id="378" class="Symbol">→</a> <a id="380" href="Karatsuba.html#281" class="Datatype">Tree</a> <a id="385" href="Karatsuba.html#291" class="Bound">A</a>

<a id="toList"></a><a id="388" href="Karatsuba.html#388" class="Function">toList</a> <a id="395" class="Symbol">:</a> <a id="397" href="Karatsuba.html#281" class="Datatype">Tree</a> <a id="402" href="Level.html#388" class="Generalizable">A</a> <a id="404" class="Symbol">→</a> <a id="406" href="Agda.Builtin.List.html#148" class="Datatype">List</a> <a id="411" href="Level.html#388" class="Generalizable">A</a>
<a id="413" href="Karatsuba.html#388" class="Function">toList</a> <a id="420" href="Karatsuba.html#420" class="Bound">xs</a> <a id="423" class="Symbol">=</a> <a id="425" href="Karatsuba.html#444" class="Function">go</a> <a id="428" href="Karatsuba.html#420" class="Bound">xs</a> <a id="431" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a>
  <a id="436" class="Keyword">where</a>
  <a id="444" href="Karatsuba.html#444" class="Function">go</a> <a id="447" class="Symbol">:</a> <a id="449" href="Karatsuba.html#281" class="Datatype">Tree</a> <a id="454" href="Level.html#388" class="Generalizable">A</a> <a id="456" class="Symbol">→</a> <a id="458" href="Agda.Builtin.List.html#148" class="Datatype">List</a> <a id="463" href="Level.html#388" class="Generalizable">A</a> <a id="465" class="Symbol">→</a> <a id="467" href="Agda.Builtin.List.html#148" class="Datatype">List</a> <a id="472" href="Level.html#388" class="Generalizable">A</a>
  <a id="476" href="Karatsuba.html#444" class="Function">go</a> <a id="479" href="Karatsuba.html#320" class="InductiveConstructor">empt</a> <a id="484" href="Karatsuba.html#484" class="Bound">ks</a> <a id="487" class="Symbol">=</a> <a id="489" href="Karatsuba.html#484" class="Bound">ks</a>
  <a id="494" href="Karatsuba.html#444" class="Function">go</a> <a id="497" class="Symbol">(</a><a id="498" href="Karatsuba.html#336" class="InductiveConstructor">leaf</a> <a id="503" href="Karatsuba.html#503" class="Bound">x</a><a id="504" class="Symbol">)</a> <a id="506" href="Karatsuba.html#506" class="Bound">ks</a> <a id="509" class="Symbol">=</a> <a id="511" href="Karatsuba.html#503" class="Bound">x</a> <a id="513" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="515" href="Karatsuba.html#506" class="Bound">ks</a>
  <a id="520" href="Karatsuba.html#444" class="Function">go</a> <a id="523" class="Symbol">(</a><a id="524" href="Karatsuba.html#524" class="Bound">ls</a> <a id="527" href="Karatsuba.html#356" class="InductiveConstructor Operator">⊗</a> <a id="529" href="Karatsuba.html#529" class="Bound">rs</a><a id="531" class="Symbol">)</a> <a id="533" href="Karatsuba.html#533" class="Bound">ks</a> <a id="536" class="Symbol">=</a> <a id="538" href="Karatsuba.html#444" class="Function">go</a> <a id="541" href="Karatsuba.html#524" class="Bound">ls</a> <a id="544" class="Symbol">(</a><a id="545" href="Karatsuba.html#444" class="Function">go</a> <a id="548" href="Karatsuba.html#529" class="Bound">rs</a> <a id="551" href="Karatsuba.html#533" class="Bound">ks</a><a id="553" class="Symbol">)</a>

<a id="556" class="Keyword">record</a> <a id="Parts"></a><a id="563" href="Karatsuba.html#563" class="Record">Parts</a> <a id="569" class="Symbol">{</a><a id="570" href="Karatsuba.html#570" class="Bound">a</a><a id="571" class="Symbol">}</a> <a id="573" class="Symbol">(</a><a id="574" href="Karatsuba.html#574" class="Bound">A</a> <a id="576" class="Symbol">:</a> <a id="578" href="Level.html#192" class="Function">Type</a> <a id="583" href="Karatsuba.html#570" class="Bound">a</a><a id="584" class="Symbol">)</a> <a id="586" class="Symbol">:</a> <a id="588" href="Level.html#192" class="Function">Type</a> <a id="593" href="Karatsuba.html#570" class="Bound">a</a> <a id="595" class="Keyword">where</a>
  <a id="603" class="Keyword">constructor</a> <a id="parts"></a><a id="615" href="Karatsuba.html#615" class="InductiveConstructor">parts</a>
  <a id="623" class="Keyword">field</a>
    <a id="Parts.shift"></a><a id="633" href="Karatsuba.html#633" class="Field">shift</a> <a id="639" class="Symbol">:</a> <a id="641" href="Agda.Builtin.Nat.html#192" class="Datatype">ℕ</a>
    <a id="Parts.lo"></a><a id="647" href="Karatsuba.html#647" class="Field">lo</a> <a id="650" class="Symbol">:</a> <a id="652" href="Karatsuba.html#281" class="Datatype">Tree</a> <a id="657" href="Karatsuba.html#574" class="Bound">A</a>
    <a id="Parts.hi"></a><a id="663" href="Karatsuba.html#663" class="Field">hi</a> <a id="666" class="Symbol">:</a> <a id="668" href="Karatsuba.html#281" class="Datatype">Tree</a> <a id="673" href="Karatsuba.html#574" class="Bound">A</a>
    <a id="Parts.out"></a><a id="679" href="Karatsuba.html#679" class="Field">out</a> <a id="683" class="Symbol">:</a> <a id="685" href="Agda.Builtin.List.html#148" class="Datatype">List</a> <a id="690" href="Karatsuba.html#574" class="Bound">A</a>
<a id="692" class="Keyword">open</a> <a id="697" href="Karatsuba.html#563" class="Module">Parts</a>

<a id="704" class="Keyword">infixl</a> <a id="711" class="Number">6</a> <a id="713" href="Karatsuba.html#717" class="Function Operator">_⊕_</a>
<a id="_⊕_"></a><a id="717" href="Karatsuba.html#717" class="Function Operator">_⊕_</a> <a id="721" class="Symbol">:</a> <a id="723" href="Agda.Builtin.List.html#148" class="Datatype">List</a> <a id="728" href="Data.Integer.html#204" class="Datatype">ℤ</a> <a id="730" class="Symbol">→</a> <a id="732" href="Agda.Builtin.List.html#148" class="Datatype">List</a> <a id="737" href="Data.Integer.html#204" class="Datatype">ℤ</a> <a id="739" class="Symbol">→</a> <a id="741" href="Agda.Builtin.List.html#148" class="Datatype">List</a> <a id="746" href="Data.Integer.html#204" class="Datatype">ℤ</a>
<a id="748" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a> <a id="751" href="Karatsuba.html#717" class="Function Operator">⊕</a> <a id="753" href="Karatsuba.html#753" class="Bound">ys</a> <a id="756" class="Symbol">=</a> <a id="758" href="Karatsuba.html#753" class="Bound">ys</a>
<a id="761" class="Symbol">(</a><a id="762" href="Karatsuba.html#762" class="Bound">x</a> <a id="764" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="766" href="Karatsuba.html#766" class="Bound">xs</a><a id="768" class="Symbol">)</a> <a id="770" href="Karatsuba.html#717" class="Function Operator">⊕</a> <a id="772" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a> <a id="775" class="Symbol">=</a> <a id="777" href="Karatsuba.html#762" class="Bound">x</a> <a id="779" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="781" href="Karatsuba.html#766" class="Bound">xs</a>
<a id="784" class="Symbol">(</a><a id="785" href="Karatsuba.html#785" class="Bound">x</a> <a id="787" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="789" href="Karatsuba.html#789" class="Bound">xs</a><a id="791" class="Symbol">)</a> <a id="793" href="Karatsuba.html#717" class="Function Operator">⊕</a> <a id="795" class="Symbol">(</a><a id="796" href="Karatsuba.html#796" class="Bound">y</a> <a id="798" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="800" href="Karatsuba.html#800" class="Bound">ys</a><a id="802" class="Symbol">)</a> <a id="804" class="Symbol">=</a> <a id="806" class="Symbol">(</a><a id="807" href="Karatsuba.html#785" class="Bound">x</a> <a id="809" href="Data.Integer.html#538" class="Function Operator">+</a> <a id="811" href="Karatsuba.html#796" class="Bound">y</a><a id="812" class="Symbol">)</a> <a id="814" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="816" class="Symbol">(</a><a id="817" href="Karatsuba.html#789" class="Bound">xs</a> <a id="820" href="Karatsuba.html#717" class="Function Operator">⊕</a> <a id="822" href="Karatsuba.html#800" class="Bound">ys</a><a id="824" class="Symbol">)</a>

<a id="pair"></a><a id="827" href="Karatsuba.html#827" class="Function">pair</a> <a id="832" class="Symbol">:</a> <a id="834" href="Agda.Builtin.List.html#148" class="Datatype">List</a> <a id="839" href="Data.Integer.html#204" class="Datatype">ℤ</a> <a id="841" class="Symbol">→</a> <a id="843" href="Agda.Builtin.List.html#148" class="Datatype">List</a> <a id="848" href="Data.Integer.html#204" class="Datatype">ℤ</a> <a id="850" class="Symbol">→</a> <a id="852" href="Agda.Builtin.List.html#148" class="Datatype">List</a> <a id="857" class="Symbol">(</a><a id="858" href="Karatsuba.html#563" class="Record">Parts</a> <a id="864" href="Data.Integer.html#204" class="Datatype">ℤ</a><a id="865" class="Symbol">)</a>
<a id="867" href="Karatsuba.html#827" class="Function">pair</a> <a id="872" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a> <a id="875" href="Karatsuba.html#875" class="Bound">ys</a> <a id="878" class="Symbol">=</a> <a id="880" href="Data.List.Base.html#1141" class="Function">map</a> <a id="884" class="Symbol">(λ</a> <a id="887" href="Karatsuba.html#887" class="Bound">y</a> <a id="889" class="Symbol">→</a> <a id="891" href="Karatsuba.html#615" class="InductiveConstructor">parts</a> <a id="897" class="Number">1</a> <a id="899" class="Symbol">(</a><a id="900" href="Karatsuba.html#336" class="InductiveConstructor">leaf</a> <a id="905" class="Number">0</a><a id="906" class="Symbol">)</a> <a id="908" class="Symbol">(</a><a id="909" href="Karatsuba.html#336" class="InductiveConstructor">leaf</a> <a id="914" href="Karatsuba.html#887" class="Bound">y</a><a id="915" class="Symbol">)</a> <a id="917" class="Symbol">(</a><a id="918" class="Number">0</a> <a id="920" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="922" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a><a id="924" class="Symbol">))</a> <a id="927" href="Karatsuba.html#875" class="Bound">ys</a>
<a id="930" href="Karatsuba.html#827" class="CatchallClause Function">pair</a><a id="934" class="CatchallClause"> </a><a id="935" href="Karatsuba.html#935" class="CatchallClause Bound">xs</a><a id="937" class="CatchallClause"> </a><a id="938" href="Agda.Builtin.List.html#185" class="CatchallClause InductiveConstructor">[]</a> <a id="941" class="Symbol">=</a> <a id="943" href="Data.List.Base.html#1141" class="Function">map</a> <a id="947" class="Symbol">(λ</a> <a id="950" href="Karatsuba.html#950" class="Bound">x</a> <a id="952" class="Symbol">→</a> <a id="954" href="Karatsuba.html#615" class="InductiveConstructor">parts</a> <a id="960" class="Number">1</a> <a id="962" class="Symbol">(</a><a id="963" href="Karatsuba.html#336" class="InductiveConstructor">leaf</a> <a id="968" href="Karatsuba.html#950" class="Bound">x</a><a id="969" class="Symbol">)</a> <a id="971" class="Symbol">(</a><a id="972" href="Karatsuba.html#336" class="InductiveConstructor">leaf</a> <a id="977" class="Number">0</a><a id="978" class="Symbol">)</a> <a id="980" class="Symbol">(</a><a id="981" class="Number">0</a> <a id="983" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="985" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a><a id="987" class="Symbol">))</a> <a id="990" href="Karatsuba.html#935" class="Bound">xs</a>
<a id="993" href="Karatsuba.html#827" class="Function">pair</a> <a id="998" class="Symbol">(</a><a id="999" href="Karatsuba.html#999" class="Bound">x</a> <a id="1001" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="1003" href="Karatsuba.html#1003" class="Bound">xs</a><a id="1005" class="Symbol">)</a> <a id="1007" class="Symbol">(</a><a id="1008" href="Karatsuba.html#1008" class="Bound">y</a> <a id="1010" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="1012" href="Karatsuba.html#1012" class="Bound">ys</a><a id="1014" class="Symbol">)</a> <a id="1016" class="Symbol">=</a> <a id="1018" href="Karatsuba.html#615" class="InductiveConstructor">parts</a> <a id="1024" class="Number">1</a> <a id="1026" class="Symbol">(</a><a id="1027" href="Karatsuba.html#336" class="InductiveConstructor">leaf</a> <a id="1032" href="Karatsuba.html#999" class="Bound">x</a><a id="1033" class="Symbol">)</a> <a id="1035" class="Symbol">(</a><a id="1036" href="Karatsuba.html#336" class="InductiveConstructor">leaf</a> <a id="1041" href="Karatsuba.html#1008" class="Bound">y</a><a id="1042" class="Symbol">)</a> <a id="1044" class="Symbol">(</a><a id="1045" href="Karatsuba.html#999" class="Bound">x</a> <a id="1047" href="Data.Integer.html#776" class="Function Operator">*</a> <a id="1049" href="Karatsuba.html#1008" class="Bound">y</a> <a id="1051" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="1053" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a><a id="1055" class="Symbol">)</a> <a id="1057" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="1059" href="Karatsuba.html#827" class="Function">pair</a> <a id="1064" href="Karatsuba.html#1003" class="Bound">xs</a> <a id="1067" href="Karatsuba.html#1012" class="Bound">ys</a>

<a id="1071" class="Comment">-- {-# TERMINATING #-}</a>
<a id="1094" class="Comment">-- mutual</a>
<a id="1104" class="Comment">--   infixl 7 _⊛_</a>
<a id="1122" class="Comment">--   _⊛_ : List ℤ → List ℤ → List ℤ</a>
<a id="1158" class="Comment">--   [] ⊛ _ = []</a>
<a id="1175" class="Comment">--   _ ⊛ [] = []</a>
<a id="1192" class="Comment">--   (x ∷ []) ⊛ ys = map (x *_) ys</a>
<a id="1227" class="Comment">--   xs ⊛ (y ∷ []) = map (y *_) xs</a>
<a id="1262" class="Comment">--   xs ⊛ ys = treeFold _◆_ (parts 0 empt empt []) (pair xs ys) .out</a>

<a id="1332" class="Comment">--   _◆_ : Parts ℤ → Parts ℤ → Parts ℤ</a>
<a id="1371" class="Comment">--   (xs ◆ ys) .shift = xs .shift ℕ.+ ys .shift</a>
<a id="1419" class="Comment">--   (xs ◆ ys) .lo = xs .lo ⊗ ys .lo</a>
<a id="1456" class="Comment">--   (xs ◆ ys) .hi = xs .hi ⊗ ys .hi</a>
<a id="1493" class="Comment">--   (parts m x0 y0 z0 ◆ parts n x1 y1 z2) .out = (replicate 0 (2 ℕ.* m) ++ z2) ⊕ (replicate 0 m ++ z1) ⊕ z0</a>
<a id="1602" class="Comment">--     where</a>
<a id="1615" class="Comment">--     z1 : List ℤ</a>
<a id="1634" class="Comment">--     z1 = (toList x1 ⊕ toList x0) ⊛ (toList y1 ⊕ toList y0) ⊕ map negate z2 ⊕ map negate z0</a>

<a id="1729" class="Comment">-- -- e : List ℤ</a>
<a id="1746" class="Comment">-- -- e = (2 ∷ 5 ∷ []) ⊛ (1 ∷ 1 ∷ [])</a>

<a id="1785" class="Comment">-- -- _ : e ≡ 2 ∷ 7 ∷ 5 ∷ 0 ∷ 0 ∷ 0 ∷ 0 ∷ 0 ∷ 0 ∷ 0 ∷ []</a>
<a id="1842" class="Comment">-- -- _ = refl</a>
</pre></body></html>