<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Data.Dyck.Prog</title><link rel="stylesheet" href="Agda.css"></head><body><pre class="Agda"><a id="1" class="Symbol">{-#</a> <a id="5" class="Keyword">OPTIONS</a> <a id="13" class="Pragma">--cubical</a> <a id="23" class="Pragma">--safe</a> <a id="30" class="Pragma">--postfix-projections</a> <a id="52" class="Symbol">#-}</a>

<a id="57" class="Comment">-- This file contains an implementation of the stack-based compiler for Hutton&#39;s</a>
<a id="138" class="Comment">-- razor, as from:</a>
<a id="157" class="Comment">--</a>
<a id="160" class="Comment">--   P. Bahr and G. Hutton, “Calculating correct compilers,” Journal of</a>
<a id="232" class="Comment">--   Functional Programming, vol. 25, no. e14, Sep. 2015,</a>
<a id="290" class="Comment">--   doi: 10.1017/S0956796815000180.</a>
<a id="327" class="Comment">--</a>
<a id="330" class="Comment">-- The compiler is total and the evaluator is stack-safe, and furthermore we have</a>
<a id="412" class="Comment">-- proven a full isomorphism between the code representation and the AST.</a>

<a id="487" class="Keyword">module</a> <a id="494" href="Data.Dyck.Prog.html" class="Module">Data.Dyck.Prog</a> <a id="509" class="Keyword">where</a>

<a id="516" class="Keyword">open</a> <a id="521" class="Keyword">import</a> <a id="528" href="Prelude.html" class="Module">Prelude</a>
<a id="536" class="Keyword">open</a> <a id="541" class="Keyword">import</a> <a id="548" href="Data.Nat.html" class="Module">Data.Nat</a> <a id="557" class="Keyword">using</a> <a id="563" class="Symbol">(</a><a id="564" href="Agda.Builtin.Nat.html#325" class="Primitive Operator">_+_</a><a id="567" class="Symbol">)</a>

<a id="570" class="Keyword">private</a> <a id="578" class="Keyword">variable</a> <a id="587" href="Data.Dyck.Prog.html#587" class="Generalizable">n</a> <a id="589" class="Symbol">:</a> <a id="591" href="Agda.Builtin.Nat.html#192" class="Datatype">ℕ</a>

<a id="594" class="Comment">--------------------------------------------------------------------------------</a>
<a id="675" class="Comment">-- We have 2 forms that we want to convert between: an AST and a flat code.</a>
<a id="751" class="Comment">--------------------------------------------------------------------------------</a>

<a id="833" class="Keyword">data</a> <a id="Expr"></a><a id="838" href="Data.Dyck.Prog.html#838" class="Datatype">Expr</a> <a id="843" class="Symbol">:</a> <a id="845" href="Agda.Primitive.html#326" class="Primitive">Type</a> <a id="850" class="Keyword">where</a>
  <a id="Expr.[_]"></a><a id="858" href="Data.Dyck.Prog.html#858" class="InductiveConstructor Operator">[_]</a> <a id="862" class="Symbol">:</a> <a id="864" href="Agda.Builtin.Nat.html#192" class="Datatype">ℕ</a> <a id="866" class="Symbol">→</a> <a id="868" href="Data.Dyck.Prog.html#838" class="Datatype">Expr</a>
  <a id="Expr._⊕_"></a><a id="875" href="Data.Dyck.Prog.html#875" class="InductiveConstructor Operator">_⊕_</a> <a id="879" class="Symbol">:</a> <a id="881" href="Data.Dyck.Prog.html#838" class="Datatype">Expr</a> <a id="886" class="Symbol">→</a> <a id="888" href="Data.Dyck.Prog.html#838" class="Datatype">Expr</a> <a id="893" class="Symbol">→</a> <a id="895" href="Data.Dyck.Prog.html#838" class="Datatype">Expr</a>

<a id="901" class="Comment">--------------------------------------------------------------------------------</a>
<a id="982" class="Comment">-- We will need a stack (a snoc-list)</a>
<a id="1020" class="Comment">--------------------------------------------------------------------------------</a>

<a id="Stack"></a><a id="1102" href="Data.Dyck.Prog.html#1102" class="Function">Stack</a> <a id="1108" class="Symbol">:</a> <a id="1110" href="Agda.Primitive.html#326" class="Primitive">Type</a> <a id="1115" class="Symbol">→</a> <a id="1117" href="Agda.Builtin.Nat.html#192" class="Datatype">ℕ</a> <a id="1119" class="Symbol">→</a> <a id="1121" href="Agda.Primitive.html#326" class="Primitive">Type</a>
<a id="1126" href="Data.Dyck.Prog.html#1102" class="Function">Stack</a> <a id="1132" href="Data.Dyck.Prog.html#1132" class="Bound">A</a> <a id="1134" href="Agda.Builtin.Nat.html#210" class="InductiveConstructor">zero</a>    <a id="1142" class="Symbol">=</a> <a id="1144" href="Agda.Builtin.Unit.html#164" class="Record">⊤</a>
<a id="1146" href="Data.Dyck.Prog.html#1102" class="Function">Stack</a> <a id="1152" href="Data.Dyck.Prog.html#1152" class="Bound">A</a> <a id="1154" class="Symbol">(</a><a id="1155" href="Agda.Builtin.Nat.html#223" class="InductiveConstructor">suc</a> <a id="1159" href="Data.Dyck.Prog.html#1159" class="Bound">n</a><a id="1160" class="Symbol">)</a> <a id="1162" class="Symbol">=</a> <a id="1164" href="Data.Dyck.Prog.html#1102" class="Function">Stack</a> <a id="1170" href="Data.Dyck.Prog.html#1152" class="Bound">A</a> <a id="1172" href="Data.Dyck.Prog.html#1159" class="Bound">n</a> <a id="1174" href="Data.Sigma.Base.html#455" class="Function Operator">×</a> <a id="1176" href="Data.Dyck.Prog.html#1152" class="Bound">A</a>

<a id="1179" class="Keyword">infixl</a> <a id="1186" class="Number">5</a> <a id="1188" href="Data.Dyck.Prog.html#1200" class="InductiveConstructor Operator">_∷_</a>
<a id="1192" class="Keyword">pattern</a> <a id="_∷_"></a><a id="1200" href="Data.Dyck.Prog.html#1200" class="InductiveConstructor Operator">_∷_</a> <a id="1204" href="Data.Dyck.Prog.html#1211" class="Bound">xs</a> <a id="1207" href="Data.Dyck.Prog.html#1216" class="Bound">x</a> <a id="1209" class="Symbol">=</a> <a id="1211" href="Data.Dyck.Prog.html#1211" class="Bound">xs</a> <a id="1214" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="1216" href="Data.Dyck.Prog.html#1216" class="Bound">x</a>

<a id="foldl"></a><a id="1219" href="Data.Dyck.Prog.html#1219" class="Function">foldl</a> <a id="1225" class="Symbol">:</a> <a id="1227" class="Symbol">∀</a> <a id="1229" class="Symbol">(</a><a id="1230" href="Data.Dyck.Prog.html#1230" class="Bound">P</a> <a id="1232" class="Symbol">:</a> <a id="1234" href="Agda.Builtin.Nat.html#192" class="Datatype">ℕ</a> <a id="1236" class="Symbol">→</a> <a id="1238" href="Agda.Primitive.html#326" class="Primitive">Type</a><a id="1242" class="Symbol">)</a> <a id="1244" class="Symbol">→</a>
          <a id="1256" class="Symbol">(∀</a> <a id="1259" class="Symbol">{</a><a id="1260" href="Data.Dyck.Prog.html#1260" class="Bound">n</a><a id="1261" class="Symbol">}</a> <a id="1263" class="Symbol">→</a> <a id="1265" href="Level.html#255" class="Generalizable">A</a> <a id="1267" class="Symbol">→</a> <a id="1269" href="Data.Dyck.Prog.html#1230" class="Bound">P</a> <a id="1271" class="Symbol">(</a><a id="1272" href="Agda.Builtin.Nat.html#223" class="InductiveConstructor">suc</a> <a id="1276" href="Data.Dyck.Prog.html#1260" class="Bound">n</a><a id="1277" class="Symbol">)</a> <a id="1279" class="Symbol">→</a> <a id="1281" href="Data.Dyck.Prog.html#1230" class="Bound">P</a> <a id="1283" href="Data.Dyck.Prog.html#1260" class="Bound">n</a><a id="1284" class="Symbol">)</a> <a id="1286" class="Symbol">→</a>
          <a id="1298" href="Data.Dyck.Prog.html#1230" class="Bound">P</a> <a id="1300" href="Data.Dyck.Prog.html#587" class="Generalizable">n</a> <a id="1302" class="Symbol">→</a>
          <a id="1314" href="Data.Dyck.Prog.html#1102" class="Function">Stack</a> <a id="1320" href="Level.html#255" class="Generalizable">A</a> <a id="1322" href="Data.Dyck.Prog.html#587" class="Generalizable">n</a> <a id="1324" class="Symbol">→</a> <a id="1326" href="Data.Dyck.Prog.html#1230" class="Bound">P</a> <a id="1328" href="Agda.Builtin.Nat.html#210" class="InductiveConstructor">zero</a>
<a id="1333" href="Data.Dyck.Prog.html#1219" class="Function">foldl</a> <a id="1339" class="Symbol">{</a><a id="1340" class="Argument">n</a> <a id="1342" class="Symbol">=</a> <a id="1344" href="Agda.Builtin.Nat.html#210" class="InductiveConstructor">zero</a><a id="1348" class="Symbol">}</a> <a id="1350" href="Data.Dyck.Prog.html#1350" class="Bound">P</a> <a id="1352" href="Data.Dyck.Prog.html#1352" class="Bound">f</a> <a id="1354" href="Data.Dyck.Prog.html#1354" class="Bound">b</a> <a id="1356" href="Data.Dyck.Prog.html#1356" class="Bound">xs</a> <a id="1359" class="Symbol">=</a> <a id="1361" href="Data.Dyck.Prog.html#1354" class="Bound">b</a>
<a id="1363" href="Data.Dyck.Prog.html#1219" class="Function">foldl</a> <a id="1369" class="Symbol">{</a><a id="1370" class="Argument">n</a> <a id="1372" class="Symbol">=</a> <a id="1374" href="Agda.Builtin.Nat.html#223" class="InductiveConstructor">suc</a> <a id="1378" href="Data.Dyck.Prog.html#1378" class="Bound">n</a><a id="1379" class="Symbol">}</a> <a id="1381" href="Data.Dyck.Prog.html#1381" class="Bound">P</a> <a id="1383" href="Data.Dyck.Prog.html#1383" class="Bound">f</a> <a id="1385" href="Data.Dyck.Prog.html#1385" class="Bound">b</a> <a id="1387" class="Symbol">(</a><a id="1388" href="Data.Dyck.Prog.html#1388" class="Bound">xs</a> <a id="1391" href="Data.Dyck.Prog.html#1200" class="InductiveConstructor Operator">∷</a> <a id="1393" href="Data.Dyck.Prog.html#1393" class="Bound">x</a><a id="1394" class="Symbol">)</a> <a id="1396" class="Symbol">=</a> <a id="1398" href="Data.Dyck.Prog.html#1219" class="Function">foldl</a> <a id="1404" href="Data.Dyck.Prog.html#1381" class="Bound">P</a> <a id="1406" href="Data.Dyck.Prog.html#1383" class="Bound">f</a> <a id="1408" class="Symbol">(</a><a id="1409" href="Data.Dyck.Prog.html#1383" class="Bound">f</a> <a id="1411" href="Data.Dyck.Prog.html#1393" class="Bound">x</a> <a id="1413" href="Data.Dyck.Prog.html#1385" class="Bound">b</a><a id="1414" class="Symbol">)</a> <a id="1416" href="Data.Dyck.Prog.html#1388" class="Bound">xs</a>

<a id="1420" class="Comment">--------------------------------------------------------------------------------</a>
<a id="1501" class="Comment">-- We do the conversion with cayley forms of the dyck monoids</a>
<a id="1563" class="Comment">--------------------------------------------------------------------------------</a>

<a id="⟨_⟩_↝_"></a><a id="1645" href="Data.Dyck.Prog.html#1645" class="Function Operator">⟨_⟩_↝_</a> <a id="1652" class="Symbol">:</a> <a id="1654" class="Symbol">(</a><a id="1655" href="Agda.Builtin.Nat.html#192" class="Datatype">ℕ</a> <a id="1657" class="Symbol">→</a> <a id="1659" href="Agda.Primitive.html#326" class="Primitive">Type</a><a id="1663" class="Symbol">)</a> <a id="1665" class="Symbol">→</a> <a id="1667" href="Agda.Builtin.Nat.html#192" class="Datatype">ℕ</a> <a id="1669" class="Symbol">→</a> <a id="1671" href="Agda.Builtin.Nat.html#192" class="Datatype">ℕ</a> <a id="1673" class="Symbol">→</a> <a id="1675" href="Agda.Primitive.html#326" class="Primitive">Type</a>
<a id="1680" href="Data.Dyck.Prog.html#1645" class="Function Operator">⟨</a> <a id="1682" href="Data.Dyck.Prog.html#1682" class="Bound">C</a> <a id="1684" href="Data.Dyck.Prog.html#1645" class="Function Operator">⟩</a> <a id="1686" href="Data.Dyck.Prog.html#1686" class="Bound">n</a> <a id="1688" href="Data.Dyck.Prog.html#1645" class="Function Operator">↝</a> <a id="1690" href="Data.Dyck.Prog.html#1690" class="Bound">m</a> <a id="1692" class="Symbol">=</a> <a id="1694" class="Symbol">∀</a> <a id="1696" class="Symbol">{</a><a id="1697" href="Data.Dyck.Prog.html#1697" class="Bound">i</a><a id="1698" class="Symbol">}</a> <a id="1700" class="Symbol">→</a> <a id="1702" href="Data.Dyck.Prog.html#1682" class="Bound">C</a> <a id="1704" class="Symbol">(</a><a id="1705" href="Data.Dyck.Prog.html#1686" class="Bound">n</a> <a id="1707" href="Agda.Builtin.Nat.html#325" class="Primitive Operator">+</a> <a id="1709" href="Data.Dyck.Prog.html#1697" class="Bound">i</a><a id="1710" class="Symbol">)</a> <a id="1712" class="Symbol">→</a> <a id="1714" href="Data.Dyck.Prog.html#1682" class="Bound">C</a> <a id="1716" class="Symbol">(</a><a id="1717" href="Data.Dyck.Prog.html#1690" class="Bound">m</a> <a id="1719" href="Agda.Builtin.Nat.html#325" class="Primitive Operator">+</a> <a id="1721" href="Data.Dyck.Prog.html#1697" class="Bound">i</a><a id="1722" class="Symbol">)</a>

<a id="1725" class="Comment">--------------------------------------------------------------------------------</a>
<a id="1806" class="Comment">-- Operations on a stack machine</a>
<a id="1839" class="Comment">--------------------------------------------------------------------------------</a>

<a id="push"></a><a id="1921" href="Data.Dyck.Prog.html#1921" class="Function">push</a> <a id="1926" class="Symbol">:</a> <a id="1928" href="Data.Dyck.Prog.html#838" class="Datatype">Expr</a> <a id="1933" class="Symbol">→</a> <a id="1935" href="Data.Dyck.Prog.html#1645" class="Function Operator">⟨</a> <a id="1937" href="Data.Dyck.Prog.html#1102" class="Function">Stack</a> <a id="1943" href="Data.Dyck.Prog.html#838" class="Datatype">Expr</a> <a id="1948" href="Data.Dyck.Prog.html#1645" class="Function Operator">⟩</a> <a id="1950" class="Number">0</a> <a id="1952" href="Data.Dyck.Prog.html#1645" class="Function Operator">↝</a> <a id="1954" class="Number">1</a>
<a id="1956" href="Data.Dyck.Prog.html#1921" class="Function">push</a> <a id="1961" href="Data.Dyck.Prog.html#1961" class="Bound">v</a> <a id="1963" href="Data.Dyck.Prog.html#1963" class="Bound">st</a> <a id="1966" class="Symbol">=</a> <a id="1968" href="Data.Dyck.Prog.html#1963" class="Bound">st</a> <a id="1971" href="Data.Dyck.Prog.html#1200" class="InductiveConstructor Operator">∷</a> <a id="1973" href="Data.Dyck.Prog.html#1961" class="Bound">v</a>

<a id="add"></a><a id="1976" href="Data.Dyck.Prog.html#1976" class="Function">add</a> <a id="1980" class="Symbol">:</a> <a id="1982" href="Data.Dyck.Prog.html#1645" class="Function Operator">⟨</a> <a id="1984" href="Data.Dyck.Prog.html#1102" class="Function">Stack</a> <a id="1990" href="Data.Dyck.Prog.html#838" class="Datatype">Expr</a> <a id="1995" href="Data.Dyck.Prog.html#1645" class="Function Operator">⟩</a> <a id="1997" class="Number">2</a> <a id="1999" href="Data.Dyck.Prog.html#1645" class="Function Operator">↝</a> <a id="2001" class="Number">1</a>
<a id="2003" href="Data.Dyck.Prog.html#1976" class="Function">add</a> <a id="2007" class="Symbol">(</a><a id="2008" href="Data.Dyck.Prog.html#2008" class="Bound">st</a> <a id="2011" href="Data.Dyck.Prog.html#1200" class="InductiveConstructor Operator">∷</a> <a id="2013" href="Data.Dyck.Prog.html#2013" class="Bound">t₁</a> <a id="2016" href="Data.Dyck.Prog.html#1200" class="InductiveConstructor Operator">∷</a> <a id="2018" href="Data.Dyck.Prog.html#2018" class="Bound">t₂</a><a id="2020" class="Symbol">)</a> <a id="2022" class="Symbol">=</a> <a id="2024" href="Data.Dyck.Prog.html#2008" class="Bound">st</a> <a id="2027" href="Data.Dyck.Prog.html#1200" class="InductiveConstructor Operator">∷</a> <a id="2029" href="Data.Dyck.Prog.html#2013" class="Bound">t₁</a> <a id="2032" href="Data.Dyck.Prog.html#875" class="InductiveConstructor Operator">⊕</a> <a id="2034" href="Data.Dyck.Prog.html#2018" class="Bound">t₂</a>

<a id="2038" class="Keyword">data</a> <a id="Code"></a><a id="2043" href="Data.Dyck.Prog.html#2043" class="Datatype">Code</a> <a id="2048" class="Symbol">:</a> <a id="2050" href="Agda.Builtin.Nat.html#192" class="Datatype">ℕ</a> <a id="2052" class="Symbol">→</a> <a id="2054" href="Agda.Primitive.html#326" class="Primitive">Type</a> <a id="2059" class="Keyword">where</a>
  <a id="Code.HALT"></a><a id="2067" href="Data.Dyck.Prog.html#2067" class="InductiveConstructor">HALT</a> <a id="2072" class="Symbol">:</a> <a id="2074" href="Data.Dyck.Prog.html#2043" class="Datatype">Code</a> <a id="2079" class="Number">1</a>
  <a id="Code.PUSH"></a><a id="2083" href="Data.Dyck.Prog.html#2083" class="InductiveConstructor">PUSH</a> <a id="2088" class="Symbol">:</a> <a id="2090" href="Agda.Builtin.Nat.html#192" class="Datatype">ℕ</a> <a id="2092" class="Symbol">→</a> <a id="2094" href="Data.Dyck.Prog.html#1645" class="Function Operator">⟨</a> <a id="2096" href="Data.Dyck.Prog.html#2043" class="Datatype">Code</a> <a id="2101" href="Data.Dyck.Prog.html#1645" class="Function Operator">⟩</a> <a id="2103" class="Number">1</a> <a id="2105" href="Data.Dyck.Prog.html#1645" class="Function Operator">↝</a> <a id="2107" class="Number">0</a>
  <a id="Code.ADD"></a><a id="2111" href="Data.Dyck.Prog.html#2111" class="InductiveConstructor">ADD</a>  <a id="2116" class="Symbol">:</a> <a id="2118" href="Data.Dyck.Prog.html#1645" class="Function Operator">⟨</a> <a id="2120" href="Data.Dyck.Prog.html#2043" class="Datatype">Code</a> <a id="2125" href="Data.Dyck.Prog.html#1645" class="Function Operator">⟩</a> <a id="2127" class="Number">1</a> <a id="2129" href="Data.Dyck.Prog.html#1645" class="Function Operator">↝</a> <a id="2131" class="Number">2</a>

<a id="2134" class="Comment">--------------------------------------------------------------------------------</a>
<a id="2215" class="Comment">-- Conversion from a Code to a Expr (evaluation / execution)</a>
<a id="2276" class="Comment">--------------------------------------------------------------------------------</a>

<a id="2358" class="Comment">--            Code n → ⟨ Stack Expr ⟩ n ↝ 1</a>
<a id="code→expr⊙"></a><a id="2402" href="Data.Dyck.Prog.html#2402" class="Function">code→expr⊙</a> <a id="2413" class="Symbol">:</a> <a id="2415" href="Data.Dyck.Prog.html#2043" class="Datatype">Code</a> <a id="2420" href="Data.Dyck.Prog.html#587" class="Generalizable">n</a> <a id="2422" class="Symbol">→</a> <a id="2424" href="Data.Dyck.Prog.html#1102" class="Function">Stack</a> <a id="2430" href="Data.Dyck.Prog.html#838" class="Datatype">Expr</a> <a id="2435" href="Data.Dyck.Prog.html#587" class="Generalizable">n</a> <a id="2437" class="Symbol">→</a> <a id="2439" href="Data.Dyck.Prog.html#838" class="Datatype">Expr</a>
<a id="2444" href="Data.Dyck.Prog.html#2402" class="Function">code→expr⊙</a> <a id="2455" href="Data.Dyck.Prog.html#2067" class="InductiveConstructor">HALT</a>        <a id="2467" class="Symbol">=</a> <a id="2469" href="Agda.Builtin.Sigma.html#264" class="Field">snd</a>
<a id="2473" href="Data.Dyck.Prog.html#2402" class="Function">code→expr⊙</a> <a id="2484" class="Symbol">(</a><a id="2485" href="Data.Dyck.Prog.html#2083" class="InductiveConstructor">PUSH</a> <a id="2490" href="Data.Dyck.Prog.html#2490" class="Bound">v</a> <a id="2492" href="Data.Dyck.Prog.html#2492" class="Bound">is</a><a id="2494" class="Symbol">)</a> <a id="2496" class="Symbol">=</a> <a id="2498" href="Data.Dyck.Prog.html#2402" class="Function">code→expr⊙</a> <a id="2509" href="Data.Dyck.Prog.html#2492" class="Bound">is</a> <a id="2512" href="Function.html#97" class="Function Operator">∘</a> <a id="2514" href="Data.Dyck.Prog.html#1921" class="Function">push</a> <a id="2519" href="Data.Dyck.Prog.html#858" class="InductiveConstructor Operator">[</a> <a id="2521" href="Data.Dyck.Prog.html#2490" class="Bound">v</a> <a id="2523" href="Data.Dyck.Prog.html#858" class="InductiveConstructor Operator">]</a>
<a id="2525" href="Data.Dyck.Prog.html#2402" class="Function">code→expr⊙</a> <a id="2536" class="Symbol">(</a><a id="2537" href="Data.Dyck.Prog.html#2111" class="InductiveConstructor">ADD</a>    <a id="2544" href="Data.Dyck.Prog.html#2544" class="Bound">is</a><a id="2546" class="Symbol">)</a> <a id="2548" class="Symbol">=</a> <a id="2550" href="Data.Dyck.Prog.html#2402" class="Function">code→expr⊙</a> <a id="2561" href="Data.Dyck.Prog.html#2544" class="Bound">is</a> <a id="2564" href="Function.html#97" class="Function Operator">∘</a> <a id="2566" href="Data.Dyck.Prog.html#1976" class="Function">add</a>

<a id="code→expr"></a><a id="2571" href="Data.Dyck.Prog.html#2571" class="Function">code→expr</a> <a id="2581" class="Symbol">:</a> <a id="2583" href="Data.Dyck.Prog.html#2043" class="Datatype">Code</a> <a id="2588" href="Agda.Builtin.Nat.html#210" class="InductiveConstructor">zero</a> <a id="2593" class="Symbol">→</a> <a id="2595" href="Data.Dyck.Prog.html#838" class="Datatype">Expr</a>
<a id="2600" href="Data.Dyck.Prog.html#2571" class="Function">code→expr</a> <a id="2610" href="Data.Dyck.Prog.html#2610" class="Bound">ds</a> <a id="2613" class="Symbol">=</a> <a id="2615" href="Data.Dyck.Prog.html#2402" class="Function">code→expr⊙</a> <a id="2626" href="Data.Dyck.Prog.html#2610" class="Bound">ds</a> <a id="2629" href="Agda.Builtin.Unit.html#201" class="InductiveConstructor">tt</a>

<a id="2633" class="Comment">--------------------------------------------------------------------------------</a>
<a id="2714" class="Comment">-- Conversion from a Expr to a Code (compilation)</a>
<a id="2764" class="Comment">--------------------------------------------------------------------------------</a>

<a id="expr→code⊙"></a><a id="2846" href="Data.Dyck.Prog.html#2846" class="Function">expr→code⊙</a> <a id="2857" class="Symbol">:</a> <a id="2859" href="Data.Dyck.Prog.html#838" class="Datatype">Expr</a> <a id="2864" class="Symbol">→</a> <a id="2866" href="Data.Dyck.Prog.html#1645" class="Function Operator">⟨</a> <a id="2868" href="Data.Dyck.Prog.html#2043" class="Datatype">Code</a> <a id="2873" href="Data.Dyck.Prog.html#1645" class="Function Operator">⟩</a> <a id="2875" class="Number">1</a> <a id="2877" href="Data.Dyck.Prog.html#1645" class="Function Operator">↝</a> <a id="2879" class="Number">0</a>
<a id="2881" href="Data.Dyck.Prog.html#2846" class="Function">expr→code⊙</a> <a id="2892" href="Data.Dyck.Prog.html#858" class="InductiveConstructor Operator">[</a> <a id="2894" href="Data.Dyck.Prog.html#2894" class="Bound">x</a> <a id="2896" href="Data.Dyck.Prog.html#858" class="InductiveConstructor Operator">]</a>     <a id="2902" class="Symbol">=</a> <a id="2904" href="Data.Dyck.Prog.html#2083" class="InductiveConstructor">PUSH</a> <a id="2909" href="Data.Dyck.Prog.html#2894" class="Bound">x</a>
<a id="2911" href="Data.Dyck.Prog.html#2846" class="Function">expr→code⊙</a> <a id="2922" class="Symbol">(</a><a id="2923" href="Data.Dyck.Prog.html#2923" class="Bound">xs</a> <a id="2926" href="Data.Dyck.Prog.html#875" class="InductiveConstructor Operator">⊕</a> <a id="2928" href="Data.Dyck.Prog.html#2928" class="Bound">ys</a><a id="2930" class="Symbol">)</a> <a id="2932" class="Symbol">=</a> <a id="2934" href="Data.Dyck.Prog.html#2846" class="Function">expr→code⊙</a> <a id="2945" href="Data.Dyck.Prog.html#2923" class="Bound">xs</a> <a id="2948" href="Function.html#97" class="Function Operator">∘</a> <a id="2950" href="Data.Dyck.Prog.html#2846" class="Function">expr→code⊙</a> <a id="2961" href="Data.Dyck.Prog.html#2928" class="Bound">ys</a> <a id="2964" href="Function.html#97" class="Function Operator">∘</a> <a id="2966" href="Data.Dyck.Prog.html#2111" class="InductiveConstructor">ADD</a>

<a id="expr→code"></a><a id="2971" href="Data.Dyck.Prog.html#2971" class="Function">expr→code</a> <a id="2981" class="Symbol">:</a> <a id="2983" href="Data.Dyck.Prog.html#838" class="Datatype">Expr</a> <a id="2988" class="Symbol">→</a> <a id="2990" href="Data.Dyck.Prog.html#2043" class="Datatype">Code</a> <a id="2995" class="Number">0</a>
<a id="2997" href="Data.Dyck.Prog.html#2971" class="Function">expr→code</a> <a id="3007" href="Data.Dyck.Prog.html#3007" class="Bound">tr</a> <a id="3010" class="Symbol">=</a> <a id="3012" href="Data.Dyck.Prog.html#2846" class="Function">expr→code⊙</a> <a id="3023" href="Data.Dyck.Prog.html#3007" class="Bound">tr</a> <a id="3026" href="Data.Dyck.Prog.html#2067" class="InductiveConstructor">HALT</a>

<a id="3032" class="Comment">--------------------------------------------------------------------------------</a>
<a id="3113" class="Comment">-- Proof of isomorphism</a>
<a id="3137" class="Comment">--------------------------------------------------------------------------------</a>

<a id="expr→code→expr⊙"></a><a id="3219" href="Data.Dyck.Prog.html#3219" class="Function">expr→code→expr⊙</a> <a id="3235" class="Symbol">:</a> <a id="3237" class="Symbol">{</a><a id="3238" href="Data.Dyck.Prog.html#3238" class="Bound">is</a> <a id="3241" class="Symbol">:</a> <a id="3243" href="Data.Dyck.Prog.html#2043" class="Datatype">Code</a> <a id="3248" class="Symbol">(</a><a id="3249" class="Number">1</a> <a id="3251" href="Agda.Builtin.Nat.html#325" class="Primitive Operator">+</a> <a id="3253" href="Data.Dyck.Prog.html#587" class="Generalizable">n</a><a id="3254" class="Symbol">)}</a> <a id="3257" class="Symbol">{</a><a id="3258" href="Data.Dyck.Prog.html#3258" class="Bound">st</a> <a id="3261" class="Symbol">:</a> <a id="3263" href="Data.Dyck.Prog.html#1102" class="Function">Stack</a> <a id="3269" href="Data.Dyck.Prog.html#838" class="Datatype">Expr</a> <a id="3274" href="Data.Dyck.Prog.html#587" class="Generalizable">n</a><a id="3275" class="Symbol">}</a> <a id="3277" class="Symbol">(</a><a id="3278" href="Data.Dyck.Prog.html#3278" class="Bound">e</a> <a id="3280" class="Symbol">:</a> <a id="3282" href="Data.Dyck.Prog.html#838" class="Datatype">Expr</a><a id="3286" class="Symbol">)</a> <a id="3288" class="Symbol">→</a>
  <a id="3292" href="Data.Dyck.Prog.html#2402" class="Function">code→expr⊙</a> <a id="3303" class="Symbol">(</a><a id="3304" href="Data.Dyck.Prog.html#2846" class="Function">expr→code⊙</a> <a id="3315" href="Data.Dyck.Prog.html#3278" class="Bound">e</a> <a id="3317" href="Data.Dyck.Prog.html#3238" class="Bound">is</a><a id="3319" class="Symbol">)</a> <a id="3321" href="Data.Dyck.Prog.html#3258" class="Bound">st</a> <a id="3324" href="Agda.Builtin.Cubical.Path.html#381" class="Function Operator">≡</a> <a id="3326" href="Data.Dyck.Prog.html#2402" class="Function">code→expr⊙</a> <a id="3337" href="Data.Dyck.Prog.html#3238" class="Bound">is</a> <a id="3340" class="Symbol">(</a><a id="3341" href="Data.Dyck.Prog.html#3258" class="Bound">st</a> <a id="3344" href="Data.Dyck.Prog.html#1200" class="InductiveConstructor Operator">∷</a> <a id="3346" href="Data.Dyck.Prog.html#3278" class="Bound">e</a><a id="3347" class="Symbol">)</a>
<a id="3349" href="Data.Dyck.Prog.html#3219" class="Function">expr→code→expr⊙</a> <a id="3365" href="Data.Dyck.Prog.html#858" class="InductiveConstructor Operator">[</a> <a id="3367" href="Data.Dyck.Prog.html#3367" class="Bound">x</a> <a id="3369" href="Data.Dyck.Prog.html#858" class="InductiveConstructor Operator">]</a>     <a id="3375" class="Symbol">=</a> <a id="3377" href="Cubical.Foundations.Id.html#560" class="Function">refl</a>
<a id="3382" href="Data.Dyck.Prog.html#3219" class="Function">expr→code→expr⊙</a> <a id="3398" class="Symbol">(</a><a id="3399" href="Data.Dyck.Prog.html#3399" class="Bound">xs</a> <a id="3402" href="Data.Dyck.Prog.html#875" class="InductiveConstructor Operator">⊕</a> <a id="3404" href="Data.Dyck.Prog.html#3404" class="Bound">ys</a><a id="3406" class="Symbol">)</a> <a id="3408" class="Symbol">=</a> <a id="3410" href="Data.Dyck.Prog.html#3219" class="Function">expr→code→expr⊙</a> <a id="3426" href="Data.Dyck.Prog.html#3399" class="Bound">xs</a> <a id="3429" href="Cubical.Foundations.Id.html#737" class="Function Operator">;</a> <a id="3431" href="Data.Dyck.Prog.html#3219" class="Function">expr→code→expr⊙</a> <a id="3447" href="Data.Dyck.Prog.html#3404" class="Bound">ys</a>

<a id="code→expr→code⊙"></a><a id="3451" href="Data.Dyck.Prog.html#3451" class="Function">code→expr→code⊙</a> <a id="3467" class="Symbol">:</a> <a id="3469" class="Symbol">{</a><a id="3470" href="Data.Dyck.Prog.html#3470" class="Bound">st</a> <a id="3473" class="Symbol">:</a> <a id="3475" href="Data.Dyck.Prog.html#1102" class="Function">Stack</a> <a id="3481" href="Data.Dyck.Prog.html#838" class="Datatype">Expr</a> <a id="3486" href="Data.Dyck.Prog.html#587" class="Generalizable">n</a><a id="3487" class="Symbol">}</a> <a id="3489" class="Symbol">(</a><a id="3490" href="Data.Dyck.Prog.html#3490" class="Bound">is</a> <a id="3493" class="Symbol">:</a> <a id="3495" href="Data.Dyck.Prog.html#2043" class="Datatype">Code</a> <a id="3500" href="Data.Dyck.Prog.html#587" class="Generalizable">n</a><a id="3501" class="Symbol">)</a> <a id="3503" class="Symbol">→</a>
 <a id="3506" href="Data.Dyck.Prog.html#2971" class="Function">expr→code</a> <a id="3516" class="Symbol">(</a><a id="3517" href="Data.Dyck.Prog.html#2402" class="Function">code→expr⊙</a> <a id="3528" href="Data.Dyck.Prog.html#3490" class="Bound">is</a> <a id="3531" href="Data.Dyck.Prog.html#3470" class="Bound">st</a><a id="3533" class="Symbol">)</a> <a id="3535" href="Agda.Builtin.Cubical.Path.html#381" class="Function Operator">≡</a> <a id="3537" href="Data.Dyck.Prog.html#1219" class="Function">foldl</a> <a id="3543" href="Data.Dyck.Prog.html#2043" class="Datatype">Code</a> <a id="3548" class="Symbol">(λ</a> <a id="3551" href="Data.Dyck.Prog.html#3551" class="Bound">x</a> <a id="3553" href="Data.Dyck.Prog.html#3553" class="Bound">xs</a> <a id="3556" class="Symbol">→</a> <a id="3558" href="Data.Dyck.Prog.html#2846" class="Function">expr→code⊙</a> <a id="3569" href="Data.Dyck.Prog.html#3551" class="Bound">x</a> <a id="3571" href="Data.Dyck.Prog.html#3553" class="Bound">xs</a><a id="3573" class="Symbol">)</a> <a id="3575" href="Data.Dyck.Prog.html#3490" class="Bound">is</a> <a id="3578" href="Data.Dyck.Prog.html#3470" class="Bound">st</a>
<a id="3581" href="Data.Dyck.Prog.html#3451" class="Function">code→expr→code⊙</a>  <a id="3598" href="Data.Dyck.Prog.html#2067" class="InductiveConstructor">HALT</a>       <a id="3609" class="Symbol">=</a> <a id="3611" href="Cubical.Foundations.Id.html#560" class="Function">refl</a>
<a id="3616" href="Data.Dyck.Prog.html#3451" class="Function">code→expr→code⊙</a> <a id="3632" class="Symbol">(</a><a id="3633" href="Data.Dyck.Prog.html#2083" class="InductiveConstructor">PUSH</a> <a id="3638" href="Data.Dyck.Prog.html#3638" class="Bound">i</a> <a id="3640" href="Data.Dyck.Prog.html#3640" class="Bound">is</a><a id="3642" class="Symbol">)</a> <a id="3644" class="Symbol">=</a> <a id="3646" href="Data.Dyck.Prog.html#3451" class="Function">code→expr→code⊙</a> <a id="3662" href="Data.Dyck.Prog.html#3640" class="Bound">is</a>
<a id="3665" href="Data.Dyck.Prog.html#3451" class="Function">code→expr→code⊙</a> <a id="3681" class="Symbol">(</a><a id="3682" href="Data.Dyck.Prog.html#2111" class="InductiveConstructor">ADD</a>    <a id="3689" href="Data.Dyck.Prog.html#3689" class="Bound">is</a><a id="3691" class="Symbol">)</a> <a id="3693" class="Symbol">=</a> <a id="3695" href="Data.Dyck.Prog.html#3451" class="Function">code→expr→code⊙</a> <a id="3711" href="Data.Dyck.Prog.html#3689" class="Bound">is</a>

<a id="prog-iso"></a><a id="3715" href="Data.Dyck.Prog.html#3715" class="Function">prog-iso</a> <a id="3724" class="Symbol">:</a> <a id="3726" href="Data.Dyck.Prog.html#2043" class="Datatype">Code</a> <a id="3731" class="Number">0</a> <a id="3733" href="Function.Isomorphism.html#338" class="Function Operator">⇔</a> <a id="3735" href="Data.Dyck.Prog.html#838" class="Datatype">Expr</a>
<a id="3740" href="Data.Dyck.Prog.html#3715" class="Function">prog-iso</a> <a id="3749" class="Symbol">.</a><a id="3750" href="Cubical.Foundations.Isomorphism.html#882" class="Field">fun</a> <a id="3754" class="Symbol">=</a> <a id="3756" href="Data.Dyck.Prog.html#2571" class="Function">code→expr</a>
<a id="3766" href="Data.Dyck.Prog.html#3715" class="Function">prog-iso</a> <a id="3775" class="Symbol">.</a><a id="3776" href="Cubical.Foundations.Isomorphism.html#898" class="Field">inv</a> <a id="3780" class="Symbol">=</a> <a id="3782" href="Data.Dyck.Prog.html#2971" class="Function">expr→code</a>
<a id="3792" href="Data.Dyck.Prog.html#3715" class="Function">prog-iso</a> <a id="3801" class="Symbol">.</a><a id="3802" href="Cubical.Foundations.Isomorphism.html#914" class="Field">rightInv</a> <a id="3811" class="Symbol">=</a> <a id="3813" href="Data.Dyck.Prog.html#3219" class="Function">expr→code→expr⊙</a>
<a id="3829" href="Data.Dyck.Prog.html#3715" class="Function">prog-iso</a> <a id="3838" class="Symbol">.</a><a id="3839" href="Cubical.Foundations.Isomorphism.html#945" class="Field">leftInv</a>  <a id="3848" class="Symbol">=</a> <a id="3850" href="Data.Dyck.Prog.html#3451" class="Function">code→expr→code⊙</a>
</pre></body></html>