<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Control.Comonad.IntervalHeap</title><link rel="stylesheet" href="Agda.css"></head><body><pre class="Agda"><a id="1" class="Symbol">{-#</a> <a id="5" class="Keyword">OPTIONS</a> <a id="13" class="Pragma">--no-positivity-check</a> <a id="35" class="Pragma">--no-termination-check</a> <a id="58" class="Symbol">#-}</a>

<a id="63" class="Keyword">open</a> <a id="68" class="Keyword">import</a> <a id="75" href="Algebra.html" class="Module">Algebra</a>
<a id="83" class="Keyword">open</a> <a id="88" class="Keyword">import</a> <a id="95" href="Prelude.html" class="Module">Prelude</a>
<a id="103" class="Keyword">open</a> <a id="108" class="Keyword">import</a> <a id="115" href="Relation.Binary.html" class="Module">Relation.Binary</a>
<a id="131" class="Keyword">open</a> <a id="136" class="Keyword">import</a> <a id="143" href="WellFounded.html" class="Module">WellFounded</a>
<a id="155" class="Keyword">open</a> <a id="160" class="Keyword">import</a> <a id="167" href="Algebra.Monus.html" class="Module">Algebra.Monus</a>
<a id="181" class="Keyword">open</a> <a id="186" class="Keyword">import</a> <a id="193" href="Data.Maybe.html" class="Module">Data.Maybe</a>
<a id="204" class="Keyword">open</a> <a id="209" class="Keyword">import</a> <a id="216" href="Data.List.html" class="Module">Data.List</a> <a id="226" class="Keyword">renaming</a> <a id="235" class="Symbol">(</a><a id="236" href="Data.List.Base.html#1042" class="Function">map</a> <a id="240" class="Symbol">to</a> <a id="243" class="Function">Lmap</a><a id="247" class="Symbol">)</a>

<a id="250" class="Keyword">module</a> <a id="257" href="Control.Comonad.IntervalHeap.html" class="Module">Control.Comonad.IntervalHeap</a> <a id="286" class="Symbol">{</a><a id="287" href="Control.Comonad.IntervalHeap.html#287" class="Bound">s</a><a id="288" class="Symbol">}</a>
  <a id="292" class="Symbol">(</a><a id="293" href="Control.Comonad.IntervalHeap.html#293" class="Bound">mon</a> <a id="297" class="Symbol">:</a> <a id="299" href="Algebra.Monus.html#4805" class="Record">TMAPOM</a> <a id="306" href="Control.Comonad.IntervalHeap.html#287" class="Bound">s</a><a id="307" class="Symbol">)</a>
  <a id="311" class="Symbol">(</a><a id="312" href="Control.Comonad.IntervalHeap.html#312" class="Bound">comon</a> <a id="318" class="Symbol">:</a> <a id="320" href="Algebra.html#11045" class="Record">GradedComonad</a> <a id="334" class="Symbol">(</a><a id="335" href="Algebra.html#2843" class="Function">TMAPOM.monoid</a> <a id="349" href="Control.Comonad.IntervalHeap.html#293" class="Bound">mon</a><a id="352" class="Symbol">)</a> <a id="354" href="Control.Comonad.IntervalHeap.html#287" class="Bound">s</a> <a id="356" href="Control.Comonad.IntervalHeap.html#287" class="Bound">s</a><a id="357" class="Symbol">)</a>
  <a id="361" class="Keyword">where</a>

<a id="368" class="Keyword">open</a> <a id="373" href="Algebra.Monus.html#4805" class="Module">TMAPOM</a> <a id="380" href="Control.Comonad.IntervalHeap.html#293" class="Bound">mon</a>
<a id="384" class="Keyword">open</a> <a id="389" href="Algebra.html#11045" class="Module">GradedComonad</a> <a id="403" href="Control.Comonad.IntervalHeap.html#312" class="Bound">comon</a>

<a id="410" class="Keyword">data</a> <a id="Heap"></a><a id="415" href="Control.Comonad.IntervalHeap.html#415" class="Datatype">Heap</a> <a id="420" class="Symbol">(</a><a id="421" href="Control.Comonad.IntervalHeap.html#421" class="Bound">A</a> <a id="423" class="Symbol">:</a> <a id="425" href="Agda.Primitive.html#326" class="Primitive">Type</a> <a id="430" href="Control.Comonad.IntervalHeap.html#287" class="Bound">s</a><a id="431" class="Symbol">)</a> <a id="433" class="Symbol">:</a> <a id="435" href="Agda.Primitive.html#326" class="Primitive">Type</a> <a id="440" href="Control.Comonad.IntervalHeap.html#287" class="Bound">s</a> <a id="442" class="Keyword">where</a>
  <a id="Heap._â—ƒ_"></a><a id="450" href="Control.Comonad.IntervalHeap.html#450" class="InductiveConstructor Operator">_â—ƒ_</a> <a id="454" class="Symbol">:</a> <a id="456" class="Symbol">(</a><a id="457" href="Control.Comonad.IntervalHeap.html#457" class="Bound">w</a> <a id="459" class="Symbol">:</a> <a id="461" href="Algebra.html#1401" class="Function">ğ‘†</a><a id="462" class="Symbol">)</a> <a id="464" class="Symbol">â†’</a> <a id="466" class="Symbol">(</a><a id="467" href="Control.Comonad.IntervalHeap.html#467" class="Bound">xs</a> <a id="470" class="Symbol">:</a> <a id="472" href="Algebra.html#11161" class="Field">ğ¹</a> <a id="474" href="Control.Comonad.IntervalHeap.html#457" class="Bound">w</a> <a id="476" class="Symbol">(</a><a id="477" href="Control.Comonad.IntervalHeap.html#421" class="Bound">A</a> <a id="479" href="Data.Sigma.Base.html#455" class="Function Operator">Ã—</a> <a id="481" href="Agda.Builtin.List.html#148" class="Datatype">List</a> <a id="486" class="Symbol">(</a><a id="487" href="Control.Comonad.IntervalHeap.html#415" class="Datatype">Heap</a> <a id="492" href="Control.Comonad.IntervalHeap.html#421" class="Bound">A</a><a id="493" class="Symbol">)))</a> <a id="497" class="Symbol">â†’</a> <a id="499" href="Control.Comonad.IntervalHeap.html#415" class="Datatype">Heap</a> <a id="504" href="Control.Comonad.IntervalHeap.html#421" class="Bound">A</a>

<a id="extend"></a><a id="507" href="Control.Comonad.IntervalHeap.html#507" class="Function">extend</a> <a id="514" class="Symbol">:</a> <a id="516" class="Symbol">(</a><a id="517" href="Control.Comonad.IntervalHeap.html#415" class="Datatype">Heap</a> <a id="522" href="Level.html#255" class="Generalizable">A</a> <a id="524" class="Symbol">â†’</a> <a id="526" href="Level.html#269" class="Generalizable">B</a><a id="527" class="Symbol">)</a> <a id="529" class="Symbol">â†’</a> <a id="531" href="Control.Comonad.IntervalHeap.html#415" class="Datatype">Heap</a> <a id="536" href="Level.html#255" class="Generalizable">A</a> <a id="538" class="Symbol">â†’</a> <a id="540" href="Control.Comonad.IntervalHeap.html#415" class="Datatype">Heap</a> <a id="545" href="Level.html#269" class="Generalizable">B</a>
<a id="547" href="Control.Comonad.IntervalHeap.html#507" class="Function">extend</a> <a id="554" href="Control.Comonad.IntervalHeap.html#554" class="Bound">f</a> <a id="556" class="Symbol">(</a><a id="557" href="Control.Comonad.IntervalHeap.html#557" class="Bound">w</a> <a id="559" href="Control.Comonad.IntervalHeap.html#450" class="InductiveConstructor Operator">â—ƒ</a> <a id="561" href="Control.Comonad.IntervalHeap.html#561" class="Bound">xs</a><a id="563" class="Symbol">)</a> <a id="565" class="Symbol">=</a> <a id="567" href="Control.Comonad.IntervalHeap.html#557" class="Bound">w</a> <a id="569" href="Control.Comonad.IntervalHeap.html#450" class="InductiveConstructor Operator">â—ƒ</a> <a id="571" class="Symbol">(</a><a id="572" href="Control.Comonad.IntervalHeap.html#561" class="Bound">xs</a> <a id="575" href="Algebra.html#11270" class="Function">=&gt;&gt;[</a> <a id="580" href="Algebra.html#1537" class="Function">âˆ™Îµ</a> <a id="583" href="Control.Comonad.IntervalHeap.html#557" class="Bound">w</a> <a id="585" href="Algebra.html#11270" class="Function">]</a> <a id="587" class="Symbol">(Î»</a> <a id="590" href="Control.Comonad.IntervalHeap.html#590" class="Bound">ys</a> <a id="593" class="Symbol">â†’</a> <a id="595" href="Control.Comonad.IntervalHeap.html#554" class="Bound">f</a> <a id="597" class="Symbol">(</a><a id="598" href="Algebra.html#1444" class="Function">Îµ</a> <a id="600" href="Control.Comonad.IntervalHeap.html#450" class="InductiveConstructor Operator">â—ƒ</a> <a id="602" href="Control.Comonad.IntervalHeap.html#590" class="Bound">ys</a><a id="604" class="Symbol">)</a> <a id="606" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="608" href="Control.Comonad.IntervalHeap.html#243" class="Function">Lmap</a> <a id="613" class="Symbol">(</a><a id="614" href="Control.Comonad.IntervalHeap.html#507" class="Function">extend</a> <a id="621" href="Control.Comonad.IntervalHeap.html#554" class="Bound">f</a><a id="622" class="Symbol">)</a> <a id="624" class="Symbol">(</a><a id="625" href="Agda.Builtin.Sigma.html#264" class="Field">snd</a> <a id="629" class="Symbol">(</a><a id="630" href="Algebra.html#11191" class="Field">extract</a> <a id="638" href="Control.Comonad.IntervalHeap.html#590" class="Bound">ys</a><a id="640" class="Symbol">))))</a>

<a id="646" class="Keyword">module</a> <a id="653" href="Control.Comonad.IntervalHeap.html#653" class="Module">_</a> <a id="655" class="Symbol">(</a><a id="656" href="Control.Comonad.IntervalHeap.html#656" class="Bound">2-monoid</a> <a id="665" class="Symbol">:</a> <a id="667" class="Symbol">âˆ€</a> <a id="669" class="Symbol">{</a><a id="670" href="Control.Comonad.IntervalHeap.html#670" class="Bound">A</a> <a id="672" href="Control.Comonad.IntervalHeap.html#672" class="Bound">B</a> <a id="674" href="Control.Comonad.IntervalHeap.html#674" class="Bound">w</a><a id="675" class="Symbol">}</a> <a id="677" class="Symbol">â†’</a> <a id="679" href="Algebra.html#11161" class="Field">ğ¹</a> <a id="681" href="Control.Comonad.IntervalHeap.html#674" class="Bound">w</a> <a id="683" href="Control.Comonad.IntervalHeap.html#670" class="Bound">A</a> <a id="685" class="Symbol">â†’</a> <a id="687" href="Algebra.html#11161" class="Field">ğ¹</a> <a id="689" href="Control.Comonad.IntervalHeap.html#674" class="Bound">w</a> <a id="691" href="Control.Comonad.IntervalHeap.html#672" class="Bound">B</a> <a id="693" class="Symbol">â†’</a> <a id="695" href="Algebra.html#11161" class="Field">ğ¹</a> <a id="697" href="Control.Comonad.IntervalHeap.html#674" class="Bound">w</a> <a id="699" class="Symbol">(</a><a id="700" href="Control.Comonad.IntervalHeap.html#670" class="Bound">A</a> <a id="702" href="Data.Sigma.Base.html#455" class="Function Operator">Ã—</a> <a id="704" href="Control.Comonad.IntervalHeap.html#672" class="Bound">B</a><a id="705" class="Symbol">))</a> <a id="708" class="Keyword">where</a>
  <a id="716" href="Control.Comonad.IntervalHeap.html#716" class="Function Operator">_âˆª_</a> <a id="720" class="Symbol">:</a> <a id="722" href="Control.Comonad.IntervalHeap.html#415" class="Datatype">Heap</a> <a id="727" href="Level.html#255" class="Generalizable">A</a> <a id="729" class="Symbol">â†’</a> <a id="731" href="Control.Comonad.IntervalHeap.html#415" class="Datatype">Heap</a> <a id="736" href="Level.html#255" class="Generalizable">A</a> <a id="738" class="Symbol">â†’</a> <a id="740" href="Control.Comonad.IntervalHeap.html#415" class="Datatype">Heap</a> <a id="745" href="Level.html#255" class="Generalizable">A</a>
  <a id="749" class="Symbol">(</a><a id="750" href="Control.Comonad.IntervalHeap.html#750" class="Bound">xw</a> <a id="753" href="Control.Comonad.IntervalHeap.html#450" class="InductiveConstructor Operator">â—ƒ</a> <a id="755" href="Control.Comonad.IntervalHeap.html#755" class="Bound">xs</a><a id="757" class="Symbol">)</a> <a id="759" href="Control.Comonad.IntervalHeap.html#716" class="Function Operator">âˆª</a> <a id="761" class="Symbol">(</a><a id="762" href="Control.Comonad.IntervalHeap.html#762" class="Bound">yw</a> <a id="765" href="Control.Comonad.IntervalHeap.html#450" class="InductiveConstructor Operator">â—ƒ</a> <a id="767" href="Control.Comonad.IntervalHeap.html#767" class="Bound">ys</a><a id="769" class="Symbol">)</a> <a id="771" class="Keyword">with</a> <a id="776" href="Control.Comonad.IntervalHeap.html#750" class="Bound">xw</a> <a id="779" href="Algebra.Monus.html#4294" class="Function Operator">â‰¤|â‰¥</a> <a id="783" href="Control.Comonad.IntervalHeap.html#762" class="Bound">yw</a>
  <a id="788" class="Symbol">...</a> <a id="792" class="Symbol">|</a> <a id="794" href="Data.Sum.html#226" class="InductiveConstructor">inl</a> <a id="798" class="Symbol">(</a><a id="799" href="Control.Comonad.IntervalHeap.html#799" class="Bound">k</a> <a id="801" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="803" href="Control.Comonad.IntervalHeap.html#803" class="Bound">p</a><a id="804" class="Symbol">)</a> <a id="806" class="Symbol">=</a> <a id="808" class="Bound">xw</a> <a id="811" href="Control.Comonad.IntervalHeap.html#450" class="InductiveConstructor Operator">â—ƒ</a> <a id="813" href="Algebra.html#12390" class="Function">map</a> <a id="817" class="Symbol">(Î»</a> <a id="820" class="Symbol">{</a> <a id="822" class="Symbol">(</a><a id="823" href="Control.Comonad.IntervalHeap.html#823" class="Bound">y</a> <a id="825" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="827" class="Symbol">(</a><a id="828" href="Control.Comonad.IntervalHeap.html#828" class="Bound">x</a> <a id="830" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="832" href="Control.Comonad.IntervalHeap.html#832" class="Bound">xs</a><a id="834" class="Symbol">))</a> <a id="837" class="Symbol">â†’</a> <a id="839" href="Control.Comonad.IntervalHeap.html#828" class="Bound">x</a> <a id="841" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="843" class="Symbol">(</a><a id="844" href="Control.Comonad.IntervalHeap.html#799" class="Bound">k</a> <a id="846" href="Control.Comonad.IntervalHeap.html#450" class="InductiveConstructor Operator">â—ƒ</a> <a id="848" href="Control.Comonad.IntervalHeap.html#823" class="Bound">y</a><a id="849" class="Symbol">)</a> <a id="851" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">âˆ·</a> <a id="853" href="Control.Comonad.IntervalHeap.html#832" class="Bound">xs</a> <a id="856" class="Symbol">})</a> <a id="859" class="Symbol">(</a><a id="860" href="Control.Comonad.IntervalHeap.html#656" class="Bound">2-monoid</a> <a id="869" class="Symbol">(</a><a id="870" class="Bound">ys</a> <a id="873" href="Algebra.html#11270" class="Function">=&gt;&gt;[</a> <a id="878" href="Cubical.Foundations.Id.html#703" class="Function">sym</a> <a id="882" href="Control.Comonad.IntervalHeap.html#803" class="Bound">p</a> <a id="884" href="Algebra.html#11270" class="Function">]</a> <a id="886" href="Function.html#533" class="Function">id</a><a id="888" class="Symbol">)</a> <a id="890" class="Bound">xs</a><a id="892" class="Symbol">)</a>
  <a id="896" class="Symbol">...</a> <a id="900" class="Symbol">|</a> <a id="902" href="Data.Sum.html#244" class="InductiveConstructor">inr</a> <a id="906" class="Symbol">(</a><a id="907" href="Control.Comonad.IntervalHeap.html#907" class="Bound">k</a> <a id="909" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="911" href="Control.Comonad.IntervalHeap.html#911" class="Bound">p</a><a id="912" class="Symbol">)</a> <a id="914" class="Symbol">=</a> <a id="916" class="Bound">yw</a> <a id="919" href="Control.Comonad.IntervalHeap.html#450" class="InductiveConstructor Operator">â—ƒ</a> <a id="921" href="Algebra.html#12390" class="Function">map</a> <a id="925" class="Symbol">(Î»</a> <a id="928" class="Symbol">{</a> <a id="930" class="Symbol">(</a><a id="931" href="Control.Comonad.IntervalHeap.html#931" class="Bound">x</a> <a id="933" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="935" class="Symbol">(</a><a id="936" href="Control.Comonad.IntervalHeap.html#936" class="Bound">y</a> <a id="938" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="940" href="Control.Comonad.IntervalHeap.html#940" class="Bound">ys</a><a id="942" class="Symbol">))</a> <a id="945" class="Symbol">â†’</a> <a id="947" href="Control.Comonad.IntervalHeap.html#936" class="Bound">y</a> <a id="949" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="951" class="Symbol">(</a><a id="952" href="Control.Comonad.IntervalHeap.html#907" class="Bound">k</a> <a id="954" href="Control.Comonad.IntervalHeap.html#450" class="InductiveConstructor Operator">â—ƒ</a> <a id="956" href="Control.Comonad.IntervalHeap.html#931" class="Bound">x</a><a id="957" class="Symbol">)</a> <a id="959" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">âˆ·</a> <a id="961" href="Control.Comonad.IntervalHeap.html#940" class="Bound">ys</a> <a id="964" class="Symbol">})</a> <a id="967" class="Symbol">(</a><a id="968" href="Control.Comonad.IntervalHeap.html#656" class="Bound">2-monoid</a> <a id="977" class="Symbol">(</a><a id="978" class="Bound">xs</a> <a id="981" href="Algebra.html#11270" class="Function">=&gt;&gt;[</a> <a id="986" href="Cubical.Foundations.Id.html#703" class="Function">sym</a> <a id="990" href="Control.Comonad.IntervalHeap.html#911" class="Bound">p</a> <a id="992" href="Algebra.html#11270" class="Function">]</a> <a id="994" href="Function.html#533" class="Function">id</a><a id="996" class="Symbol">)</a> <a id="998" class="Bound">ys</a><a id="1000" class="Symbol">)</a>

<a id="1003" class="Comment">-- mutual</a>
<a id="1013" class="Comment">--   record Heap (A : Type a) : Type (s â„“âŠ” a) where</a>
<a id="1065" class="Comment">--     inductive; constructor _â—ƒ_</a>
<a id="1099" class="Comment">--     field</a>
<a id="1112" class="Comment">--       hd : A</a>
<a id="1128" class="Comment">--       tl : Next A</a>

<a id="1150" class="Comment">--   record Next {a} (A : Type a) : Type (s â„“âŠ” a) where</a>
<a id="1206" class="Comment">--     coinductive; constructor âŸª_âŸ«</a>
<a id="1242" class="Comment">--     field next : Span A</a>

<a id="1270" class="Comment">--   data Span {a} (A : Type a) : Type (s â„“âŠ” a) where</a>
<a id="1324" class="Comment">--     [] : Span A</a>
<a id="1343" class="Comment">--     until : (s : ğ‘†) â†’ (sâ‰¢Îµ : s â‰¢ Îµ) â†’ (xs : Heap A) â†’ Span A</a>
<a id="1407" class="Comment">-- open Heap public</a>
<a id="1427" class="Comment">-- open Next public</a>

<a id="1448" class="Comment">-- State : Type a â†’ Type _</a>
<a id="1475" class="Comment">-- State A = ğ‘† â†’ A Ã— ğ‘†</a>

<a id="1499" class="Comment">-- popâ€² : (s : ğ‘†) â†’ Acc _&lt;_ s â†’ Heap A â†’ A Ã— ğ‘†</a>
<a id="1546" class="Comment">-- popâ€² sâ‚‚ a xs with xs .tl .next</a>
<a id="1580" class="Comment">-- popâ€² sâ‚‚ a xs | [] = xs .hd , Îµ</a>
<a id="1614" class="Comment">-- popâ€² sâ‚‚ a xs | until sâ‚ sâ‚â‰¢Îµ ys with sâ‚ â‰¤? sâ‚‚</a>
<a id="1663" class="Comment">-- popâ€² sâ‚‚ a xs | until sâ‚ sâ‚â‰¢Îµ ys | no sâ‚â‰°sâ‚‚ = xs .hd , fst (&lt;â‡’â‰¤ sâ‚â‰°sâ‚‚)</a>
<a id="1736" class="Comment">-- popâ€² sâ‚‚ (acc wf) xs | until sâ‚ sâ‚â‰¢Îµ ys | yes (kâ‚ , sâ‚‚â‰¡sâ‚âˆ™kâ‚) = popâ€² kâ‚ (wf kâ‚ lemma) ys</a>
<a id="1827" class="Comment">--   where</a>
<a id="1838" class="Comment">--   lemma : kâ‚ &lt; sâ‚‚</a>
<a id="1859" class="Comment">--   lemma (kâ‚‚ , kâ‚â‰¡sâ‚‚âˆ™kâ‚‚) = sâ‚â‰¢Îµ (zeroSumFree sâ‚ kâ‚‚ (sym (cancel kâ‚ _ _ p)))</a>
<a id="1937" class="Comment">--     where</a>
<a id="1950" class="Comment">--     p : kâ‚ âˆ™ Îµ â‰¡ kâ‚ âˆ™ (sâ‚ âˆ™ kâ‚‚)</a>
<a id="1985" class="Comment">--     p = âˆ™Îµ kâ‚ Í¾ kâ‚â‰¡sâ‚‚âˆ™kâ‚‚ Í¾ cong (_âˆ™ kâ‚‚) sâ‚‚â‰¡sâ‚âˆ™kâ‚ Í¾ cong (_âˆ™ kâ‚‚) (comm sâ‚ kâ‚) Í¾ assoc kâ‚ sâ‚ kâ‚‚</a>

<a id="2083" class="Comment">-- pop : Heap A â†’ State A</a>
<a id="2109" class="Comment">-- pop xs s = popâ€² s (wf s) xs</a>

<a id="2141" class="Comment">-- mutual</a>
<a id="2151" class="Comment">--   stepFrom : State A â†’ (s : ğ‘†) â†’ Dec (s â‰¡ Îµ) â†’ Span A</a>
<a id="2208" class="Comment">--   stepFrom f s (yes p) = []</a>
<a id="2239" class="Comment">--   stepFrom f s (no Â¬p) = until s Â¬p (tabulate (f âˆ˜ (s âˆ™_)))</a>

<a id="2303" class="Comment">--   tabulate : State A â†’ Heap A</a>
<a id="2336" class="Comment">--   tabulate f =</a>
<a id="2354" class="Comment">--     let x , s = f Îµ</a>
<a id="2377" class="Comment">--     in x â—ƒ Î» where .next â†’ stepFrom f s (s â‰Ÿ Îµ)</a>

<a id="2429" class="Comment">-- pop-Îµ : (xs : Heap A) (a : Acc _&lt;_ Îµ) â†’ popâ€² Îµ a xs .fst â‰¡ xs .hd</a>
<a id="2498" class="Comment">-- pop-Îµ xs _ with xs .tl .next</a>
<a id="2530" class="Comment">-- pop-Îµ xs _ | [] = refl</a>
<a id="2556" class="Comment">-- pop-Îµ xs _ | until s sâ‰¢Îµ ys with s â‰¤? Îµ</a>
<a id="2599" class="Comment">-- pop-Îµ xs _ | until s sâ‰¢Îµ ys | no  sâ‰°Îµ = refl</a>
<a id="2647" class="Comment">-- pop-Îµ xs _ | until s sâ‰¢Îµ ys | yes sâ‰¤Îµ = âŠ¥-elim (sâ‰¢Îµ (antisym sâ‰¤Îµ (positive s)))</a>

<a id="2731" class="Comment">-- -- slide : Heap A â†’ Heap A</a>
<a id="2761" class="Comment">-- -- slide xs with xs .tl .next</a>
<a id="2794" class="Comment">-- -- slide xs | [] = xs</a>
<a id="2819" class="Comment">-- -- slide xs | [] = []</a>

<a id="2845" class="Comment">-- -- pop-tl : âˆ€ (x : A) sâ‚ (sâ‚â‰¢Îµ : sâ‚ â‰¢ Îµ) xs sâ‚‚ â†’ pop (x â—ƒ âŸª until sâ‚ sâ‚â‰¢Îµ xs âŸ«) (sâ‚ âˆ™ sâ‚‚) â‰¡ pop xs sâ‚‚</a>
<a id="2950" class="Comment">-- -- pop-tl x sâ‚ sâ‚â‰¢Îµ xs sâ‚‚ with sâ‚ â‰¤? (sâ‚ âˆ™ sâ‚‚)</a>
<a id="3000" class="Comment">-- -- pop-tl x sâ‚ sâ‚â‰¢Îµ xs sâ‚‚ | no  sâ‚â‰°sâ‚âˆ™sâ‚‚ = âŠ¥-elim (sâ‚â‰°sâ‚âˆ™sâ‚‚ (sâ‚‚ , refl))</a>
<a id="3076" class="Comment">-- -- pop-tl x sâ‚ sâ‚â‰¢Îµ xs sâ‚‚ | yes (k , sâ‚â‰¤sâ‚âˆ™sâ‚‚) =</a>
<a id="3128" class="Comment">-- --   let p = cancel sâ‚ sâ‚‚ k sâ‚â‰¤sâ‚âˆ™sâ‚‚</a>
<a id="3168" class="Comment">-- --   in {!!} Í¾ cong (Î» w â†’ popâ€² sâ‚‚ w xs) (isPropAcc {!!} (wf sâ‚‚))</a>

<a id="3238" class="Comment">-- -- seg-leftInvâ€² : (x : Heap A) â†’ tabulate (pop x) â‰¡ x</a>
<a id="3295" class="Comment">-- -- seg-leftInvâ€² x = {!!}</a>

<a id="3324" class="Comment">-- -- mutual</a>
<a id="3337" class="Comment">-- --   seg-leftInvâ€² : (xs : Heap A) â†’ stepFrom (pop xs) (pop xs Îµ .snd) (pop xs Îµ .snd â‰Ÿ Îµ) â‰¡ xs .tl .next</a>
<a id="3445" class="Comment">-- --   seg-leftInvâ€² (x â—ƒ xs) with pop (x â—ƒ xs) Îµ .snd â‰Ÿ Îµ</a>
<a id="3504" class="Comment">-- --   seg-leftInvâ€² (x â—ƒ xs) | yes sâ‰¡Îµ = {!!}</a>
<a id="3551" class="Comment">-- --   seg-leftInvâ€² (x â—ƒ xs) | no  sâ‰¢Îµ = {!!}</a>

<a id="3599" class="Comment">-- --   seg-leftInv : (x : Heap A) â†’ tabulate (pop x) â‰¡ x</a>
<a id="3657" class="Comment">-- --   seg-leftInv (x â—ƒ xs) i .hd = pop-Îµ (x â—ƒ xs) (wf Îµ) i</a>
<a id="3718" class="Comment">-- --   seg-leftInv (x â—ƒ xs) i .tl .next = seg-leftInvâ€² (x â—ƒ xs) i</a>

<a id="3786" class="Comment">-- -- state-iso : Heap A â‡” State A</a>
<a id="3821" class="Comment">-- -- state-iso .fun = pop</a>
<a id="3848" class="Comment">-- -- state-iso .inv = tabulate</a>
<a id="3880" class="Comment">-- -- state-iso .rightInv = {!!}</a>
<a id="3913" class="Comment">-- -- state-iso .leftInv  = {!!}</a>
</pre></body></html>