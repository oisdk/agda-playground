<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Control.Comonad.IntervalHeap</title><link rel="stylesheet" href="Agda.css"></head><body><pre class="Agda"><a id="1" class="Symbol">{-#</a> <a id="5" class="Keyword">OPTIONS</a> <a id="13" class="Pragma">--no-positivity-check</a> <a id="35" class="Pragma">--no-termination-check</a> <a id="58" class="Symbol">#-}</a>

<a id="63" class="Keyword">open</a> <a id="68" class="Keyword">import</a> <a id="75" href="Algebra.html" class="Module">Algebra</a>
<a id="83" class="Keyword">open</a> <a id="88" class="Keyword">import</a> <a id="95" href="Prelude.html" class="Module">Prelude</a>
<a id="103" class="Keyword">open</a> <a id="108" class="Keyword">import</a> <a id="115" href="Relation.Binary.html" class="Module">Relation.Binary</a>
<a id="131" class="Keyword">open</a> <a id="136" class="Keyword">import</a> <a id="143" href="WellFounded.html" class="Module">WellFounded</a>
<a id="155" class="Keyword">open</a> <a id="160" class="Keyword">import</a> <a id="167" href="Algebra.Monus.html" class="Module">Algebra.Monus</a>
<a id="181" class="Keyword">open</a> <a id="186" class="Keyword">import</a> <a id="193" href="Data.Maybe.html" class="Module">Data.Maybe</a>
<a id="204" class="Keyword">open</a> <a id="209" class="Keyword">import</a> <a id="216" href="Data.List.html" class="Module">Data.List</a> <a id="226" class="Keyword">renaming</a> <a id="235" class="Symbol">(</a><a id="236" href="Data.List.Base.html#1042" class="Function">map</a> <a id="240" class="Symbol">to</a> <a id="243" class="Function">Lmap</a><a id="247" class="Symbol">)</a>

<a id="250" class="Keyword">module</a> <a id="257" href="Control.Comonad.IntervalHeap.html" class="Module">Control.Comonad.IntervalHeap</a> <a id="286" class="Symbol">{</a><a id="287" href="Control.Comonad.IntervalHeap.html#287" class="Bound">s</a><a id="288" class="Symbol">}</a>
  <a id="292" class="Symbol">(</a><a id="293" href="Control.Comonad.IntervalHeap.html#293" class="Bound">mon</a> <a id="297" class="Symbol">:</a> <a id="299" href="Algebra.Monus.html#4805" class="Record">TMAPOM</a> <a id="306" href="Control.Comonad.IntervalHeap.html#287" class="Bound">s</a><a id="307" class="Symbol">)</a>
  <a id="311" class="Symbol">(</a><a id="312" href="Control.Comonad.IntervalHeap.html#312" class="Bound">comon</a> <a id="318" class="Symbol">:</a> <a id="320" href="Algebra.html#11045" class="Record">GradedComonad</a> <a id="334" class="Symbol">(</a><a id="335" href="Algebra.html#2843" class="Function">TMAPOM.monoid</a> <a id="349" href="Control.Comonad.IntervalHeap.html#293" class="Bound">mon</a><a id="352" class="Symbol">)</a> <a id="354" href="Control.Comonad.IntervalHeap.html#287" class="Bound">s</a> <a id="356" href="Control.Comonad.IntervalHeap.html#287" class="Bound">s</a><a id="357" class="Symbol">)</a>
  <a id="361" class="Keyword">where</a>

<a id="368" class="Keyword">open</a> <a id="373" href="Algebra.Monus.html#4805" class="Module">TMAPOM</a> <a id="380" href="Control.Comonad.IntervalHeap.html#293" class="Bound">mon</a>
<a id="384" class="Keyword">open</a> <a id="389" href="Algebra.html#11045" class="Module">GradedComonad</a> <a id="403" href="Control.Comonad.IntervalHeap.html#312" class="Bound">comon</a> <a id="409" class="Keyword">renaming</a> <a id="418" class="Symbol">(</a><a id="419" href="Algebra.html#11161" class="Field">ğ¹</a> <a id="421" class="Symbol">to</a> <a id="424" class="Field">ğ‘Š</a><a id="425" class="Symbol">)</a>

<a id="Weighted"></a><a id="428" href="Control.Comonad.IntervalHeap.html#428" class="Function">Weighted</a> <a id="437" class="Symbol">:</a> <a id="439" class="Symbol">(</a><a id="440" href="Algebra.html#1401" class="Function">ğ‘†</a> <a id="442" class="Symbol">â†’</a> <a id="444" href="Agda.Primitive.html#326" class="Primitive">Type</a> <a id="449" href="Level.html#239" class="Generalizable">a</a> <a id="451" class="Symbol">â†’</a> <a id="453" href="Agda.Primitive.html#326" class="Primitive">Type</a> <a id="458" href="Level.html#241" class="Generalizable">b</a><a id="459" class="Symbol">)</a> <a id="461" class="Symbol">â†’</a> <a id="463" href="Agda.Primitive.html#326" class="Primitive">Type</a> <a id="468" href="Level.html#239" class="Generalizable">a</a> <a id="470" class="Symbol">â†’</a> <a id="472" href="Agda.Primitive.html#326" class="Primitive">Type</a> <a id="477" class="Symbol">(</a><a id="478" href="Control.Comonad.IntervalHeap.html#287" class="Bound">s</a> <a id="480" href="Agda.Primitive.html#810" class="Primitive Operator">â„“âŠ”</a> <a id="483" href="Level.html#241" class="Generalizable">b</a><a id="484" class="Symbol">)</a>
<a id="486" href="Control.Comonad.IntervalHeap.html#428" class="Function">Weighted</a> <a id="495" href="Control.Comonad.IntervalHeap.html#495" class="Bound">C</a> <a id="497" href="Control.Comonad.IntervalHeap.html#497" class="Bound">A</a> <a id="499" class="Symbol">=</a> <a id="501" href="Data.Sigma.Base.html#173" class="Function">âˆƒ</a> <a id="503" href="Control.Comonad.IntervalHeap.html#503" class="Bound">w</a> <a id="505" href="Data.Sigma.Base.html#173" class="Function">Ã—</a> <a id="507" href="Control.Comonad.IntervalHeap.html#495" class="Bound">C</a> <a id="509" href="Control.Comonad.IntervalHeap.html#503" class="Bound">w</a> <a id="511" href="Control.Comonad.IntervalHeap.html#497" class="Bound">A</a>

<a id="514" class="Keyword">private</a> <a id="522" class="Keyword">variable</a> <a id="531" href="Control.Comonad.IntervalHeap.html#531" class="Generalizable">u</a> <a id="533" href="Control.Comonad.IntervalHeap.html#533" class="Generalizable">v</a> <a id="535" href="Control.Comonad.IntervalHeap.html#535" class="Generalizable">w</a> <a id="537" class="Symbol">:</a> <a id="539" href="Algebra.html#1401" class="Function">ğ‘†</a>

<a id="542" class="Keyword">module</a> <a id="549" href="Control.Comonad.IntervalHeap.html#549" class="Module">_</a> <a id="551" class="Symbol">(</a><a id="552" href="Control.Comonad.IntervalHeap.html#552" class="Bound">functor</a> <a id="560" class="Symbol">:</a> <a id="562" href="Algebra.html#5756" class="Record">Functor</a> <a id="570" href="Control.Comonad.IntervalHeap.html#287" class="Bound">s</a> <a id="572" href="Control.Comonad.IntervalHeap.html#287" class="Bound">s</a><a id="573" class="Symbol">)</a> <a id="575" class="Keyword">where</a>
  <a id="583" class="Keyword">open</a> <a id="588" href="Algebra.html#5756" class="Module">Functor</a> <a id="596" href="Control.Comonad.IntervalHeap.html#552" class="Bound">functor</a> <a id="604" class="Keyword">renaming</a> <a id="613" class="Symbol">(</a><a id="614" href="Algebra.html#5841" class="Field">map</a> <a id="618" class="Symbol">to</a> <a id="621" class="Field">fmap</a><a id="625" class="Symbol">)</a>

  <a id="630" class="Keyword">record</a> <a id="637" href="Control.Comonad.IntervalHeap.html#637" class="Record">Cofreeâº</a> <a id="645" class="Symbol">(</a><a id="646" href="Control.Comonad.IntervalHeap.html#646" class="Bound">w</a> <a id="648" class="Symbol">:</a> <a id="650" href="Algebra.html#1401" class="Function">ğ‘†</a><a id="651" class="Symbol">)</a> <a id="653" class="Symbol">(</a><a id="654" href="Control.Comonad.IntervalHeap.html#654" class="Bound">A</a> <a id="656" class="Symbol">:</a> <a id="658" href="Agda.Primitive.html#326" class="Primitive">Type</a> <a id="663" href="Control.Comonad.IntervalHeap.html#287" class="Bound">s</a><a id="664" class="Symbol">)</a> <a id="666" class="Symbol">:</a> <a id="668" href="Agda.Primitive.html#326" class="Primitive">Type</a> <a id="673" href="Control.Comonad.IntervalHeap.html#287" class="Bound">s</a> <a id="675" class="Keyword">where</a>
    <a id="685" class="Keyword">constructor</a> <a id="697" href="Control.Comonad.IntervalHeap.html#697" class="InductiveConstructor Operator">âŸª_âŸ«</a>
    <a id="705" class="Keyword">field</a> <a id="711" href="Control.Comonad.IntervalHeap.html#711" class="Field">step</a> <a id="716" class="Symbol">:</a> <a id="718" href="Control.Comonad.IntervalHeap.html#424" class="Field">ğ‘Š</a> <a id="720" href="Control.Comonad.IntervalHeap.html#646" class="Bound">w</a> <a id="722" class="Symbol">(</a><a id="723" href="Control.Comonad.IntervalHeap.html#654" class="Bound">A</a> <a id="725" href="Data.Sigma.Base.html#455" class="Function Operator">Ã—</a> <a id="727" href="Algebra.html#5813" class="Field">ğ¹</a> <a id="729" class="Symbol">(</a><a id="730" href="Control.Comonad.IntervalHeap.html#428" class="Function">Weighted</a> <a id="739" href="Control.Comonad.IntervalHeap.html#637" class="Record">Cofreeâº</a> <a id="747" href="Control.Comonad.IntervalHeap.html#654" class="Bound">A</a><a id="748" class="Symbol">))</a>
  <a id="753" class="Keyword">open</a> <a id="758" href="Control.Comonad.IntervalHeap.html#637" class="Module">Cofreeâº</a> <a id="766" class="Keyword">public</a>

  <a id="776" href="Control.Comonad.IntervalHeap.html#776" class="Function">Cofree</a> <a id="783" class="Symbol">:</a> <a id="785" href="Agda.Primitive.html#326" class="Primitive">Type</a> <a id="790" href="Control.Comonad.IntervalHeap.html#287" class="Bound">s</a> <a id="792" class="Symbol">â†’</a> <a id="794" href="Agda.Primitive.html#326" class="Primitive">Type</a> <a id="799" href="Control.Comonad.IntervalHeap.html#287" class="Bound">s</a>
  <a id="803" href="Control.Comonad.IntervalHeap.html#776" class="Function">Cofree</a> <a id="810" class="Symbol">=</a> <a id="812" href="Control.Comonad.IntervalHeap.html#637" class="Record">Cofreeâº</a> <a id="820" href="Algebra.html#1444" class="Function">Îµ</a>

  <a id="825" href="Control.Comonad.IntervalHeap.html#825" class="Function">extend</a> <a id="832" class="Symbol">:</a> <a id="834" class="Symbol">(</a><a id="835" href="Control.Comonad.IntervalHeap.html#776" class="Function">Cofree</a> <a id="842" href="Level.html#255" class="Generalizable">A</a> <a id="844" class="Symbol">â†’</a> <a id="846" href="Level.html#269" class="Generalizable">B</a><a id="847" class="Symbol">)</a> <a id="849" class="Symbol">â†’</a> <a id="851" href="Control.Comonad.IntervalHeap.html#637" class="Record">Cofreeâº</a> <a id="859" href="Control.Comonad.IntervalHeap.html#535" class="Generalizable">w</a> <a id="861" href="Level.html#255" class="Generalizable">A</a> <a id="863" class="Symbol">â†’</a> <a id="865" href="Control.Comonad.IntervalHeap.html#637" class="Record">Cofreeâº</a> <a id="873" href="Control.Comonad.IntervalHeap.html#535" class="Generalizable">w</a> <a id="875" href="Level.html#269" class="Generalizable">B</a>
  <a id="879" href="Control.Comonad.IntervalHeap.html#825" class="Function">extend</a> <a id="886" href="Control.Comonad.IntervalHeap.html#886" class="Bound">f</a> <a id="888" href="Control.Comonad.IntervalHeap.html#888" class="Bound">x</a> <a id="890" class="Symbol">.</a><a id="891" href="Control.Comonad.IntervalHeap.html#711" class="Field">step</a> <a id="896" class="Symbol">=</a> <a id="898" href="Control.Comonad.IntervalHeap.html#888" class="Bound">x</a> <a id="900" class="Symbol">.</a><a id="901" href="Control.Comonad.IntervalHeap.html#711" class="Field">step</a> <a id="906" href="Algebra.html#11270" class="Function">=&gt;&gt;[</a> <a id="911" href="Algebra.html#1537" class="Function">âˆ™Îµ</a> <a id="914" class="Symbol">_</a> <a id="916" href="Algebra.html#11270" class="Function">]</a> <a id="918" class="Symbol">Î»</a> <a id="920" href="Control.Comonad.IntervalHeap.html#920" class="Bound">ys</a> <a id="923" class="Symbol">â†’</a> <a id="925" href="Control.Comonad.IntervalHeap.html#886" class="Bound">f</a> <a id="927" href="Control.Comonad.IntervalHeap.html#697" class="InductiveConstructor Operator">âŸª</a> <a id="929" href="Control.Comonad.IntervalHeap.html#920" class="Bound">ys</a> <a id="932" href="Control.Comonad.IntervalHeap.html#697" class="InductiveConstructor Operator">âŸ«</a> <a id="934" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="936" href="Control.Comonad.IntervalHeap.html#621" class="Field">fmap</a> <a id="941" class="Symbol">(</a><a id="942" href="Data.Sigma.Base.html#1309" class="Function">mapâ‚‚</a> <a id="947" class="Symbol">(</a><a id="948" href="Control.Comonad.IntervalHeap.html#825" class="Function">extend</a> <a id="955" href="Control.Comonad.IntervalHeap.html#886" class="Bound">f</a><a id="956" class="Symbol">))</a> <a id="959" class="Symbol">(</a><a id="960" href="Agda.Builtin.Sigma.html#264" class="Field">snd</a> <a id="964" class="Symbol">(</a><a id="965" href="Algebra.html#11191" class="Field">extract</a> <a id="973" href="Control.Comonad.IntervalHeap.html#920" class="Bound">ys</a><a id="975" class="Symbol">))</a> 

  <a id="982" href="Control.Comonad.IntervalHeap.html#982" class="Function">extractâ€²</a> <a id="991" class="Symbol">:</a> <a id="993" href="Control.Comonad.IntervalHeap.html#776" class="Function">Cofree</a> <a id="1000" href="Level.html#255" class="Generalizable">A</a> <a id="1002" class="Symbol">â†’</a> <a id="1004" href="Level.html#255" class="Generalizable">A</a>
  <a id="1008" href="Control.Comonad.IntervalHeap.html#982" class="Function">extractâ€²</a> <a id="1017" class="Symbol">=</a> <a id="1019" href="Agda.Builtin.Sigma.html#252" class="Field">fst</a> <a id="1023" href="Function.html#97" class="Function Operator">âˆ˜</a> <a id="1025" href="Algebra.html#11191" class="Field">extract</a> <a id="1033" href="Function.html#97" class="Function Operator">âˆ˜</a> <a id="1035" href="Control.Comonad.IntervalHeap.html#711" class="Field">step</a>

  <a id="1043" href="Control.Comonad.IntervalHeap.html#1043" class="Function">traceT</a> <a id="1050" class="Symbol">:</a> <a id="1052" class="Symbol">(</a><a id="1053" href="Control.Comonad.IntervalHeap.html#424" class="Field">ğ‘Š</a> <a id="1055" href="Algebra.html#1444" class="Function">Îµ</a> <a id="1057" href="Level.html#255" class="Generalizable">A</a> <a id="1059" class="Symbol">â†’</a> <a id="1061" href="Level.html#269" class="Generalizable">B</a><a id="1062" class="Symbol">)</a> <a id="1064" class="Symbol">â†’</a> <a id="1066" class="Symbol">(</a><a id="1067" href="Control.Comonad.IntervalHeap.html#424" class="Field">ğ‘Š</a> <a id="1069" href="Algebra.html#1444" class="Function">Îµ</a> <a id="1071" href="Level.html#255" class="Generalizable">A</a> <a id="1073" class="Symbol">â†’</a> <a id="1075" href="Algebra.html#5813" class="Field">ğ¹</a> <a id="1077" class="Symbol">(</a><a id="1078" href="Control.Comonad.IntervalHeap.html#428" class="Function">Weighted</a> <a id="1087" href="Control.Comonad.IntervalHeap.html#424" class="Field">ğ‘Š</a> <a id="1089" href="Level.html#255" class="Generalizable">A</a><a id="1090" class="Symbol">))</a> <a id="1093" class="Symbol">â†’</a> <a id="1095" href="Control.Comonad.IntervalHeap.html#424" class="Field">ğ‘Š</a> <a id="1097" href="Control.Comonad.IntervalHeap.html#535" class="Generalizable">w</a> <a id="1099" href="Level.html#255" class="Generalizable">A</a> <a id="1101" class="Symbol">â†’</a> <a id="1103" href="Control.Comonad.IntervalHeap.html#637" class="Record">Cofreeâº</a> <a id="1111" href="Control.Comonad.IntervalHeap.html#535" class="Generalizable">w</a> <a id="1113" href="Level.html#269" class="Generalizable">B</a>
  <a id="1117" href="Control.Comonad.IntervalHeap.html#1043" class="Function">traceT</a> <a id="1124" href="Control.Comonad.IntervalHeap.html#1124" class="Bound">f</a> <a id="1126" href="Control.Comonad.IntervalHeap.html#1126" class="Bound">c</a> <a id="1128" href="Control.Comonad.IntervalHeap.html#1128" class="Bound">r</a> <a id="1130" class="Symbol">.</a><a id="1131" href="Control.Comonad.IntervalHeap.html#711" class="Field">step</a> <a id="1136" class="Symbol">=</a> <a id="1138" href="Control.Comonad.IntervalHeap.html#1128" class="Bound">r</a> <a id="1140" href="Algebra.html#11270" class="Function">=&gt;&gt;[</a> <a id="1145" href="Algebra.html#1537" class="Function">âˆ™Îµ</a> <a id="1148" class="Symbol">_</a> <a id="1150" href="Algebra.html#11270" class="Function">]</a> <a id="1152" class="Symbol">Î»</a> <a id="1154" href="Control.Comonad.IntervalHeap.html#1154" class="Bound">rs</a> <a id="1157" class="Symbol">â†’</a> <a id="1159" href="Control.Comonad.IntervalHeap.html#1124" class="Bound">f</a> <a id="1161" href="Control.Comonad.IntervalHeap.html#1154" class="Bound">rs</a> <a id="1164" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="1166" href="Control.Comonad.IntervalHeap.html#621" class="Field">fmap</a> <a id="1171" class="Symbol">(</a><a id="1172" href="Data.Sigma.Base.html#1309" class="Function">mapâ‚‚</a> <a id="1177" class="Symbol">(</a><a id="1178" href="Control.Comonad.IntervalHeap.html#1043" class="Function">traceT</a> <a id="1185" href="Control.Comonad.IntervalHeap.html#1124" class="Bound">f</a> <a id="1187" href="Control.Comonad.IntervalHeap.html#1126" class="Bound">c</a><a id="1188" class="Symbol">))</a> <a id="1191" class="Symbol">(</a><a id="1192" href="Control.Comonad.IntervalHeap.html#1126" class="Bound">c</a> <a id="1194" href="Control.Comonad.IntervalHeap.html#1154" class="Bound">rs</a><a id="1196" class="Symbol">)</a>

  <a id="1201" href="Control.Comonad.IntervalHeap.html#1201" class="Function">iterT</a> <a id="1207" class="Symbol">:</a> <a id="1209" class="Symbol">(</a><a id="1210" href="Control.Comonad.IntervalHeap.html#424" class="Field">ğ‘Š</a> <a id="1212" href="Algebra.html#1444" class="Function">Îµ</a> <a id="1214" href="Level.html#255" class="Generalizable">A</a> <a id="1216" class="Symbol">â†’</a> <a id="1218" href="Algebra.html#5813" class="Field">ğ¹</a> <a id="1220" class="Symbol">(</a><a id="1221" href="Control.Comonad.IntervalHeap.html#428" class="Function">Weighted</a> <a id="1230" href="Control.Comonad.IntervalHeap.html#424" class="Field">ğ‘Š</a> <a id="1232" href="Level.html#255" class="Generalizable">A</a><a id="1233" class="Symbol">))</a> <a id="1236" class="Symbol">â†’</a> <a id="1238" href="Control.Comonad.IntervalHeap.html#424" class="Field">ğ‘Š</a> <a id="1240" href="Algebra.html#1444" class="Function">Îµ</a> <a id="1242" href="Level.html#255" class="Generalizable">A</a> <a id="1244" class="Symbol">â†’</a> <a id="1246" href="Control.Comonad.IntervalHeap.html#776" class="Function">Cofree</a> <a id="1253" href="Level.html#255" class="Generalizable">A</a>
  <a id="1257" href="Control.Comonad.IntervalHeap.html#1201" class="Function">iterT</a> <a id="1263" class="Symbol">=</a> <a id="1265" href="Control.Comonad.IntervalHeap.html#1043" class="Function">traceT</a> <a id="1272" href="Algebra.html#11191" class="Field">extract</a>




<a id="1284" class="Comment">-- data Heap (A : Type s) : Type s where</a>
<a id="1325" class="Comment">--   _â—ƒ_ : (w : ğ‘†) â†’ (xs : ğ¹ w (A Ã— List (Heap A))) â†’ Heap A</a>

<a id="1387" class="Comment">-- extend : (Heap A â†’ B) â†’ Heap A â†’ Heap B</a>
<a id="1430" class="Comment">-- extend f (w â—ƒ xs) = w â—ƒ (xs =&gt;&gt;[ âˆ™Îµ w ] (Î» ys â†’ f (Îµ â—ƒ ys) , Lmap (extend f) (snd (extract ys))))</a>

<a id="1532" class="Comment">-- module _ (2-monoid : âˆ€ {A B w} â†’ ğ¹ w A â†’ ğ¹ w B â†’ ğ¹ w (A Ã— B)) where</a>
<a id="1603" class="Comment">--   _âˆª_ : Heap A â†’ Heap A â†’ Heap A</a>
<a id="1639" class="Comment">--   (xw â—ƒ xs) âˆª (yw â—ƒ ys) with xw â‰¤|â‰¥ yw</a>
<a id="1681" class="Comment">--   ... | inl (k , p) = xw â—ƒ map (Î» { (y , (x , xs)) â†’ x , (k â—ƒ y) âˆ· xs }) (2-monoid (ys =&gt;&gt;[ sym p ] id) xs)</a>
<a id="1792" class="Comment">--   ... | inr (k , p) = yw â—ƒ map (Î» { (x , (y , ys)) â†’ y , (k â—ƒ x) âˆ· ys }) (2-monoid (xs =&gt;&gt;[ sym p ] id) ys)</a>

<a id="1904" class="Comment">-- -- mutual</a>
<a id="1917" class="Comment">-- --   record Heap (A : Type a) : Type (s â„“âŠ” a) where</a>
<a id="1972" class="Comment">-- --     inductive; constructor _â—ƒ_</a>
<a id="2009" class="Comment">-- --     field</a>
<a id="2025" class="Comment">-- --       hd : A</a>
<a id="2044" class="Comment">-- --       tl : Next A</a>

<a id="2069" class="Comment">-- --   record Next {a} (A : Type a) : Type (s â„“âŠ” a) where</a>
<a id="2128" class="Comment">-- --     coinductive; constructor âŸª_âŸ«</a>
<a id="2167" class="Comment">-- --     field next : Span A</a>

<a id="2198" class="Comment">-- --   data Span {a} (A : Type a) : Type (s â„“âŠ” a) where</a>
<a id="2255" class="Comment">-- --     [] : Span A</a>
<a id="2277" class="Comment">-- --     until : (s : ğ‘†) â†’ (sâ‰¢Îµ : s â‰¢ Îµ) â†’ (xs : Heap A) â†’ Span A</a>
<a id="2344" class="Comment">-- -- open Heap public</a>
<a id="2367" class="Comment">-- -- open Next public</a>

<a id="2391" class="Comment">-- -- State : Type a â†’ Type _</a>
<a id="2421" class="Comment">-- -- State A = ğ‘† â†’ A Ã— ğ‘†</a>

<a id="2448" class="Comment">-- -- popâ€² : (s : ğ‘†) â†’ Acc _&lt;_ s â†’ Heap A â†’ A Ã— ğ‘†</a>
<a id="2498" class="Comment">-- -- popâ€² sâ‚‚ a xs with xs .tl .next</a>
<a id="2535" class="Comment">-- -- popâ€² sâ‚‚ a xs | [] = xs .hd , Îµ</a>
<a id="2572" class="Comment">-- -- popâ€² sâ‚‚ a xs | until sâ‚ sâ‚â‰¢Îµ ys with sâ‚ â‰¤? sâ‚‚</a>
<a id="2624" class="Comment">-- -- popâ€² sâ‚‚ a xs | until sâ‚ sâ‚â‰¢Îµ ys | no sâ‚â‰°sâ‚‚ = xs .hd , fst (&lt;â‡’â‰¤ sâ‚â‰°sâ‚‚)</a>
<a id="2700" class="Comment">-- -- popâ€² sâ‚‚ (acc wf) xs | until sâ‚ sâ‚â‰¢Îµ ys | yes (kâ‚ , sâ‚‚â‰¡sâ‚âˆ™kâ‚) = popâ€² kâ‚ (wf kâ‚ lemma) ys</a>
<a id="2794" class="Comment">-- --   where</a>
<a id="2808" class="Comment">-- --   lemma : kâ‚ &lt; sâ‚‚</a>
<a id="2832" class="Comment">-- --   lemma (kâ‚‚ , kâ‚â‰¡sâ‚‚âˆ™kâ‚‚) = sâ‚â‰¢Îµ (zeroSumFree sâ‚ kâ‚‚ (sym (cancel kâ‚ _ _ p)))</a>
<a id="2913" class="Comment">-- --     where</a>
<a id="2929" class="Comment">-- --     p : kâ‚ âˆ™ Îµ â‰¡ kâ‚ âˆ™ (sâ‚ âˆ™ kâ‚‚)</a>
<a id="2967" class="Comment">-- --     p = âˆ™Îµ kâ‚ Í¾ kâ‚â‰¡sâ‚‚âˆ™kâ‚‚ Í¾ cong (_âˆ™ kâ‚‚) sâ‚‚â‰¡sâ‚âˆ™kâ‚ Í¾ cong (_âˆ™ kâ‚‚) (comm sâ‚ kâ‚) Í¾ assoc kâ‚ sâ‚ kâ‚‚</a>

<a id="3068" class="Comment">-- -- pop : Heap A â†’ State A</a>
<a id="3097" class="Comment">-- -- pop xs s = popâ€² s (wf s) xs</a>

<a id="3132" class="Comment">-- -- mutual</a>
<a id="3145" class="Comment">-- --   stepFrom : State A â†’ (s : ğ‘†) â†’ Dec (s â‰¡ Îµ) â†’ Span A</a>
<a id="3205" class="Comment">-- --   stepFrom f s (yes p) = []</a>
<a id="3239" class="Comment">-- --   stepFrom f s (no Â¬p) = until s Â¬p (tabulate (f âˆ˜ (s âˆ™_)))</a>

<a id="3306" class="Comment">-- --   tabulate : State A â†’ Heap A</a>
<a id="3342" class="Comment">-- --   tabulate f =</a>
<a id="3363" class="Comment">-- --     let x , s = f Îµ</a>
<a id="3389" class="Comment">-- --     in x â—ƒ Î» where .next â†’ stepFrom f s (s â‰Ÿ Îµ)</a>

<a id="3444" class="Comment">-- -- pop-Îµ : (xs : Heap A) (a : Acc _&lt;_ Îµ) â†’ popâ€² Îµ a xs .fst â‰¡ xs .hd</a>
<a id="3516" class="Comment">-- -- pop-Îµ xs _ with xs .tl .next</a>
<a id="3551" class="Comment">-- -- pop-Îµ xs _ | [] = refl</a>
<a id="3580" class="Comment">-- -- pop-Îµ xs _ | until s sâ‰¢Îµ ys with s â‰¤? Îµ</a>
<a id="3626" class="Comment">-- -- pop-Îµ xs _ | until s sâ‰¢Îµ ys | no  sâ‰°Îµ = refl</a>
<a id="3677" class="Comment">-- -- pop-Îµ xs _ | until s sâ‰¢Îµ ys | yes sâ‰¤Îµ = âŠ¥-elim (sâ‰¢Îµ (antisym sâ‰¤Îµ (positive s)))</a>

<a id="3764" class="Comment">-- -- -- slide : Heap A â†’ Heap A</a>
<a id="3797" class="Comment">-- -- -- slide xs with xs .tl .next</a>
<a id="3833" class="Comment">-- -- -- slide xs | [] = xs</a>
<a id="3861" class="Comment">-- -- -- slide xs | [] = []</a>

<a id="3890" class="Comment">-- -- -- pop-tl : âˆ€ (x : A) sâ‚ (sâ‚â‰¢Îµ : sâ‚ â‰¢ Îµ) xs sâ‚‚ â†’ pop (x â—ƒ âŸª until sâ‚ sâ‚â‰¢Îµ xs âŸ«) (sâ‚ âˆ™ sâ‚‚) â‰¡ pop xs sâ‚‚</a>
<a id="3998" class="Comment">-- -- -- pop-tl x sâ‚ sâ‚â‰¢Îµ xs sâ‚‚ with sâ‚ â‰¤? (sâ‚ âˆ™ sâ‚‚)</a>
<a id="4051" class="Comment">-- -- -- pop-tl x sâ‚ sâ‚â‰¢Îµ xs sâ‚‚ | no  sâ‚â‰°sâ‚âˆ™sâ‚‚ = âŠ¥-elim (sâ‚â‰°sâ‚âˆ™sâ‚‚ (sâ‚‚ , refl))</a>
<a id="4130" class="Comment">-- -- -- pop-tl x sâ‚ sâ‚â‰¢Îµ xs sâ‚‚ | yes (k , sâ‚â‰¤sâ‚âˆ™sâ‚‚) =</a>
<a id="4185" class="Comment">-- -- --   let p = cancel sâ‚ sâ‚‚ k sâ‚â‰¤sâ‚âˆ™sâ‚‚</a>
<a id="4228" class="Comment">-- -- --   in {!!} Í¾ cong (Î» w â†’ popâ€² sâ‚‚ w xs) (isPropAcc {!!} (wf sâ‚‚))</a>

<a id="4301" class="Comment">-- -- -- seg-leftInvâ€² : (x : Heap A) â†’ tabulate (pop x) â‰¡ x</a>
<a id="4361" class="Comment">-- -- -- seg-leftInvâ€² x = {!!}</a>

<a id="4393" class="Comment">-- -- -- mutual</a>
<a id="4409" class="Comment">-- -- --   seg-leftInvâ€² : (xs : Heap A) â†’ stepFrom (pop xs) (pop xs Îµ .snd) (pop xs Îµ .snd â‰Ÿ Îµ) â‰¡ xs .tl .next</a>
<a id="4520" class="Comment">-- -- --   seg-leftInvâ€² (x â—ƒ xs) with pop (x â—ƒ xs) Îµ .snd â‰Ÿ Îµ</a>
<a id="4582" class="Comment">-- -- --   seg-leftInvâ€² (x â—ƒ xs) | yes sâ‰¡Îµ = {!!}</a>
<a id="4632" class="Comment">-- -- --   seg-leftInvâ€² (x â—ƒ xs) | no  sâ‰¢Îµ = {!!}</a>

<a id="4683" class="Comment">-- -- --   seg-leftInv : (x : Heap A) â†’ tabulate (pop x) â‰¡ x</a>
<a id="4744" class="Comment">-- -- --   seg-leftInv (x â—ƒ xs) i .hd = pop-Îµ (x â—ƒ xs) (wf Îµ) i</a>
<a id="4808" class="Comment">-- -- --   seg-leftInv (x â—ƒ xs) i .tl .next = seg-leftInvâ€² (x â—ƒ xs) i</a>

<a id="4879" class="Comment">-- -- -- state-iso : Heap A â‡” State A</a>
<a id="4917" class="Comment">-- -- -- state-iso .fun = pop</a>
<a id="4947" class="Comment">-- -- -- state-iso .inv = tabulate</a>
<a id="4982" class="Comment">-- -- -- state-iso .rightInv = {!!}</a>
<a id="5018" class="Comment">-- -- -- state-iso .leftInv  = {!!}</a>
</pre></body></html>