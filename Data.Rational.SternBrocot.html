<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Data.Rational.SternBrocot</title><link rel="stylesheet" href="Agda.css"></head><body><pre class="Agda"><a id="1" class="Symbol">{-#</a> <a id="5" class="Keyword">OPTIONS</a> <a id="13" class="Pragma">--cubical</a> <a id="23" class="Pragma">--safe</a> <a id="30" class="Symbol">#-}</a>

<a id="35" class="Keyword">module</a> <a id="42" href="Data.Rational.SternBrocot.html" class="Module">Data.Rational.SternBrocot</a> <a id="68" class="Keyword">where</a>

<a id="75" class="Keyword">open</a> <a id="80" class="Keyword">import</a> <a id="87" href="Prelude.html" class="Module">Prelude</a>
<a id="95" class="Keyword">import</a> <a id="102" href="Data.Nat.html" class="Module">Data.Nat</a> <a id="111" class="Symbol">as</a> <a id="114" class="Module">ℕ</a>
<a id="116" class="Keyword">import</a> <a id="123" href="Data.Nat.Properties.html" class="Module">Data.Nat.Properties</a> <a id="143" class="Symbol">as</a> <a id="146" class="Module">ℕ</a>
<a id="148" class="Keyword">open</a> <a id="153" class="Keyword">import</a> <a id="160" href="Data.Bits.html" class="Module">Data.Bits</a> <a id="170" class="Keyword">renaming</a> <a id="179" class="Symbol">(</a><a id="180" href="Data.Bits.html#102" class="Datatype">Bits</a> <a id="185" class="Symbol">to</a> <a id="188" class="Datatype">ℚ⁺</a><a id="190" class="Symbol">;</a> <a id="192" href="Data.Bits.html#122" class="InductiveConstructor">[]</a> <a id="195" class="Symbol">to</a> <a id="198" class="InductiveConstructor">1ℚ</a><a id="200" class="Symbol">;</a> <a id="202" href="Data.Bits.html#134" class="InductiveConstructor Operator">0∷_</a> <a id="206" class="Symbol">to</a> <a id="209" class="InductiveConstructor Operator">lℚ</a><a id="211" class="Symbol">;</a> <a id="213" href="Data.Bits.html#154" class="InductiveConstructor Operator">1∷_</a> <a id="217" class="Symbol">to</a> <a id="220" class="InductiveConstructor Operator">rℚ</a><a id="222" class="Symbol">)</a>
<a id="224" class="Keyword">open</a> <a id="229" class="Keyword">import</a> <a id="236" href="Data.Bits.Equatable.html" class="Module">Data.Bits.Equatable</a>

<a id="257" class="Comment">-- ⟦_⇓⟧ : ℚ⁺ → (ℕ × ℕ)</a>
<a id="280" class="Comment">-- ⟦ 1ℚ ⇓⟧ = 1 , 1</a>
<a id="299" class="Comment">-- ⟦ lℚ x ⇓⟧ = let p , q = ⟦ x ⇓⟧ in p , p ℕ.+ q</a>
<a id="348" class="Comment">-- ⟦ rℚ x ⇓⟧ = let p , q = ⟦ x ⇓⟧ in p ℕ.+ q , q</a>

<a id="398" class="Comment">-- module TerminationProofs where</a>
<a id="432" class="Comment">--   Tᴮ⇒≡ : {n m : ℕ} → n ≡ m → T (n ℕ.≡ᴮ m)</a>
<a id="477" class="Comment">--   Tᴮ⇒≡ {n} {m} n≡m = subst (λ n′ → T (n ℕ.≡ᴮ n′)) n≡m (ℕ.complete-== n)</a>

<a id="553" class="Comment">--   lift-suc-≡ : ∀ {n m} s → m ≡ n → T (n ℕ.≡ᴮ s) → T (m ℕ.≡ᴮ s)</a>
<a id="619" class="Comment">--   lift-suc-≡ {n} {m} s  m≡n p = Tᴮ⇒≡ (m≡n ; ℕ.sound-== (n) s p)</a>

<a id="687" class="Comment">--   lemma₁ : ∀ a m → a ℕ.+ m ℕ.+ zero ≡ m ℕ.+ a</a>
<a id="736" class="Comment">--   lemma₁ a m = ℕ.+-idʳ (a ℕ.+ m) ; ℕ.+-comm a m</a>

<a id="788" class="Comment">--   lemma₂ : ∀ n a m → n ℕ.+ m ℕ.+ suc a ≡ n ℕ.+ suc m ℕ.+ a</a>
<a id="850" class="Comment">--   lemma₂ n a m = ℕ.+-assoc n m (suc a) ; cong (n ℕ.+_) (ℕ.+-suc m a) ; sym (ℕ.+-assoc n (suc m) a)</a>

<a id="953" class="Comment">--   lemma₃ : ∀ n a → n ℕ.+ a ℕ.+ zero ≡ n ℕ.+ zero ℕ.+ a</a>
<a id="1011" class="Comment">--   lemma₃ n a = ℕ.+-idʳ (n ℕ.+ a) ; cong (ℕ._+ a) (sym (ℕ.+-idʳ n))</a>

<a id="1082" class="Comment">-- _+1/_+1 : ℕ → ℕ → ℚ⁺</a>
<a id="1106" class="Comment">-- n +1/ m +1 = go zero n m (n ℕ.+ m)</a>
<a id="1144" class="Comment">--   where</a>
<a id="1155" class="Comment">--   go : (a n m s : ℕ) → ℚ⁺</a>
<a id="1184" class="Comment">--   go a zero    (suc m) (suc s) = lℚ (go zero a m s)</a>
<a id="1239" class="Comment">--   go a (suc n) (suc m) (suc s) = go (suc a) n m s</a>
<a id="1292" class="Comment">--   go a (suc n) zero    (suc s) = rℚ (go zero n a s)</a>
<a id="1347" class="Comment">--   go _ _       _       _       = 1ℚ</a>

<a id="euclidian"></a><a id="1387" href="Data.Rational.SternBrocot.html#1387" class="Function">euclidian</a> <a id="1397" class="Symbol">:</a> <a id="1399" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a> <a id="1401" class="Symbol">→</a> <a id="1403" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a> <a id="1405" class="Symbol">→</a> <a id="1407" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a> <a id="1409" class="Symbol">→</a> <a id="1411" href="Data.Rational.SternBrocot.html#188" class="Datatype">ℚ⁺</a>
<a id="1414" href="Data.Rational.SternBrocot.html#1387" class="Function">euclidian</a> <a id="1424" href="Data.Rational.SternBrocot.html#1424" class="Bound">n</a> <a id="1426" href="Data.Rational.SternBrocot.html#1426" class="Bound">m</a> <a id="1428" href="Agda.Builtin.Nat.html#221" class="InductiveConstructor">zero</a>    <a id="1436" class="Symbol">=</a> <a id="1438" href="Data.Rational.SternBrocot.html#198" class="InductiveConstructor">1ℚ</a>
<a id="1441" href="Data.Rational.SternBrocot.html#1387" class="Function">euclidian</a> <a id="1451" href="Data.Rational.SternBrocot.html#1451" class="Bound">n</a> <a id="1453" href="Data.Rational.SternBrocot.html#1453" class="Bound">m</a> <a id="1455" class="Symbol">(</a><a id="1456" href="Agda.Builtin.Nat.html#234" class="InductiveConstructor">suc</a> <a id="1460" href="Data.Rational.SternBrocot.html#1460" class="Bound">s</a><a id="1461" class="Symbol">)</a> <a id="1463" class="Symbol">=</a>
  <a id="1467" href="Data.Bool.Base.html#596" class="Function Operator">if</a> <a id="1470" href="Data.Rational.SternBrocot.html#1451" class="Bound">n</a> <a id="1472" href="Data.Nat.Properties.html#867" class="Primitive Operator">ℕ.Eqℕ.≡ᴮ</a> <a id="1481" href="Data.Rational.SternBrocot.html#1453" class="Bound">m</a>
  <a id="1485" href="Data.Bool.Base.html#596" class="Function Operator">then</a> <a id="1490" href="Data.Rational.SternBrocot.html#198" class="InductiveConstructor">1ℚ</a>
  <a id="1495" href="Data.Bool.Base.html#596" class="Function Operator">else</a> <a id="1500" href="Data.Bool.Base.html#596" class="Function Operator">if</a> <a id="1503" href="Data.Rational.SternBrocot.html#1451" class="Bound">n</a> <a id="1505" href="Data.Nat.Properties.html#150" class="Primitive Operator">ℕ.&lt;ᴮ</a> <a id="1510" href="Data.Rational.SternBrocot.html#1453" class="Bound">m</a>
  <a id="1514" href="Data.Bool.Base.html#596" class="Function Operator">then</a> <a id="1519" href="Data.Rational.SternBrocot.html#209" class="InductiveConstructor">lℚ</a> <a id="1522" class="Symbol">(</a><a id="1523" href="Data.Rational.SternBrocot.html#1387" class="Function">euclidian</a> <a id="1533" href="Data.Rational.SternBrocot.html#1451" class="Bound">n</a> <a id="1535" class="Symbol">(</a><a id="1536" href="Data.Rational.SternBrocot.html#1453" class="Bound">m</a> <a id="1538" href="Data.Nat.Base.html#160" class="Primitive Operator">ℕ.∸</a> <a id="1542" class="Symbol">(</a><a id="1543" class="Number">1</a> <a id="1545" href="Agda.Builtin.Nat.html#336" class="Primitive Operator">ℕ.+</a> <a id="1549" href="Data.Rational.SternBrocot.html#1451" class="Bound">n</a><a id="1550" class="Symbol">))</a> <a id="1553" href="Data.Rational.SternBrocot.html#1460" class="Bound">s</a><a id="1554" class="Symbol">)</a>
  <a id="1558" href="Data.Bool.Base.html#596" class="Function Operator">else</a> <a id="1563" href="Data.Rational.SternBrocot.html#220" class="InductiveConstructor">rℚ</a> <a id="1566" class="Symbol">(</a><a id="1567" href="Data.Rational.SternBrocot.html#1387" class="Function">euclidian</a> <a id="1577" class="Symbol">(</a><a id="1578" href="Data.Rational.SternBrocot.html#1451" class="Bound">n</a> <a id="1580" href="Data.Nat.Base.html#160" class="Primitive Operator">ℕ.∸</a> <a id="1584" class="Symbol">(</a><a id="1585" class="Number">1</a> <a id="1587" href="Agda.Builtin.Nat.html#336" class="Primitive Operator">ℕ.+</a> <a id="1591" href="Data.Rational.SternBrocot.html#1453" class="Bound">m</a><a id="1592" class="Symbol">))</a> <a id="1595" href="Data.Rational.SternBrocot.html#1453" class="Bound">m</a> <a id="1597" href="Data.Rational.SternBrocot.html#1460" class="Bound">s</a><a id="1598" class="Symbol">)</a>

<a id="normalise-suc"></a><a id="1601" href="Data.Rational.SternBrocot.html#1601" class="Function">normalise-suc</a> <a id="1615" class="Symbol">:</a> <a id="1617" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a> <a id="1619" class="Symbol">→</a> <a id="1621" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a> <a id="1623" class="Symbol">→</a> <a id="1625" href="Data.Rational.SternBrocot.html#188" class="Datatype">ℚ⁺</a>
<a id="1628" href="Data.Rational.SternBrocot.html#1601" class="Function">normalise-suc</a> <a id="1642" href="Data.Rational.SternBrocot.html#1642" class="Bound">n</a> <a id="1644" href="Data.Rational.SternBrocot.html#1644" class="Bound">m</a> <a id="1646" class="Symbol">=</a> <a id="1648" href="Data.Rational.SternBrocot.html#1387" class="Function">euclidian</a> <a id="1658" href="Data.Rational.SternBrocot.html#1642" class="Bound">n</a> <a id="1660" href="Data.Rational.SternBrocot.html#1644" class="Bound">m</a> <a id="1662" class="Symbol">(</a><a id="1663" href="Data.Rational.SternBrocot.html#1642" class="Bound">n</a> <a id="1665" href="Agda.Builtin.Nat.html#336" class="Primitive Operator">ℕ.+</a> <a id="1669" href="Data.Rational.SternBrocot.html#1644" class="Bound">m</a><a id="1670" class="Symbol">)</a>

<a id="ℚ"></a><a id="1673" href="Data.Rational.SternBrocot.html#1673" class="Function">ℚ</a> <a id="1675" class="Symbol">:</a> <a id="1677" href="Agda.Primitive.html#388" class="Primitive">Type</a>
<a id="1682" href="Data.Rational.SternBrocot.html#1673" class="Function">ℚ</a> <a id="1684" class="Symbol">=</a> <a id="1686" href="Data.Rational.SternBrocot.html#188" class="Datatype">ℚ⁺</a>

<a id="1690" class="Keyword">import</a> <a id="1697" href="Data.Rational.Unnormalised.html" class="Module">Data.Rational.Unnormalised</a> <a id="1724" class="Symbol">as</a> <a id="1727" class="Module">F</a>
<a id="1729" class="Keyword">open</a> <a id="1734" class="Keyword">import</a> <a id="1741" href="Data.Rational.Unnormalised.html" class="Module">Data.Rational.Unnormalised</a> <a id="1768" class="Keyword">using</a> <a id="1774" class="Symbol">(</a><a id="1775" href="Data.Rational.Unnormalised.html#303" class="InductiveConstructor Operator">_/suc_</a><a id="1781" class="Symbol">;</a> <a id="1783" href="Data.Rational.Unnormalised.html#394" class="Function Operator">_/_</a><a id="1786" class="Symbol">)</a>
<a id="1788" class="Keyword">import</a> <a id="1795" href="Data.Integer.html" class="Module">Data.Integer</a> <a id="1808" class="Symbol">as</a> <a id="1811" class="Module">ℤ</a>
<a id="1813" class="Keyword">open</a> <a id="1818" class="Keyword">import</a> <a id="1825" href="Data.Integer.html" class="Module">Data.Integer</a> <a id="1838" class="Keyword">using</a> <a id="1844" class="Symbol">(</a><a id="1845" href="Data.Integer.html#204" class="Datatype">ℤ</a><a id="1846" class="Symbol">;</a> <a id="1848" href="Data.Integer.html#221" class="InductiveConstructor">⁺</a><a id="1849" class="Symbol">;</a> <a id="1851" href="Data.Integer.html#235" class="InductiveConstructor">⁻suc</a><a id="1855" class="Symbol">;</a> <a id="1857" href="Data.Integer.html#249" class="Function">⁻</a><a id="1858" class="Symbol">)</a>
<a id="1860" class="Keyword">open</a> <a id="1865" class="Keyword">import</a> <a id="1872" href="Data.Bits.Fold.html" class="Module">Data.Bits.Fold</a>

<a id="zer"></a><a id="1888" href="Data.Rational.SternBrocot.html#1888" class="Function">zer</a> <a id="1892" class="Symbol">:</a> <a id="1894" class="Symbol">(</a><a id="1895" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a> <a id="1897" href="Data.Sigma.Base.html#455" class="Function Operator">×</a> <a id="1899" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a><a id="1900" class="Symbol">)</a> <a id="1902" class="Symbol">→</a> <a id="1904" class="Symbol">(</a><a id="1905" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a> <a id="1907" href="Data.Sigma.Base.html#455" class="Function Operator">×</a> <a id="1909" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a><a id="1910" class="Symbol">)</a>
<a id="1912" href="Data.Rational.SternBrocot.html#1888" class="Function">zer</a> <a id="1916" class="Symbol">(</a><a id="1917" href="Data.Rational.SternBrocot.html#1917" class="Bound">p</a> <a id="1919" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1921" href="Data.Rational.SternBrocot.html#1921" class="Bound">q</a><a id="1922" class="Symbol">)</a> <a id="1924" class="Symbol">=</a> <a id="1926" href="Data.Rational.SternBrocot.html#1917" class="Bound">p</a> <a id="1928" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1930" href="Agda.Builtin.Nat.html#234" class="InductiveConstructor">suc</a> <a id="1934" href="Data.Rational.SternBrocot.html#1917" class="Bound">p</a> <a id="1936" href="Agda.Builtin.Nat.html#336" class="Primitive Operator">ℕ.+</a> <a id="1940" href="Data.Rational.SternBrocot.html#1921" class="Bound">q</a>

<a id="one"></a><a id="1943" href="Data.Rational.SternBrocot.html#1943" class="Function">one</a> <a id="1947" class="Symbol">:</a> <a id="1949" class="Symbol">(</a><a id="1950" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a> <a id="1952" href="Data.Sigma.Base.html#455" class="Function Operator">×</a> <a id="1954" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a><a id="1955" class="Symbol">)</a> <a id="1957" class="Symbol">→</a> <a id="1959" class="Symbol">(</a><a id="1960" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a> <a id="1962" href="Data.Sigma.Base.html#455" class="Function Operator">×</a> <a id="1964" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a><a id="1965" class="Symbol">)</a>
<a id="1967" href="Data.Rational.SternBrocot.html#1943" class="Function">one</a> <a id="1971" class="Symbol">(</a><a id="1972" href="Data.Rational.SternBrocot.html#1972" class="Bound">p</a> <a id="1974" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1976" href="Data.Rational.SternBrocot.html#1976" class="Bound">q</a><a id="1977" class="Symbol">)</a> <a id="1979" class="Symbol">=</a> <a id="1981" href="Agda.Builtin.Nat.html#234" class="InductiveConstructor">suc</a> <a id="1985" href="Data.Rational.SternBrocot.html#1972" class="Bound">p</a> <a id="1987" href="Agda.Builtin.Nat.html#336" class="Primitive Operator">ℕ.+</a> <a id="1991" href="Data.Rational.SternBrocot.html#1976" class="Bound">q</a> <a id="1993" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1995" href="Data.Rational.SternBrocot.html#1976" class="Bound">q</a>

<a id="fraction"></a><a id="1998" href="Data.Rational.SternBrocot.html#1998" class="Function">fraction</a> <a id="2007" class="Symbol">:</a> <a id="2009" href="Data.Rational.SternBrocot.html#1673" class="Function">ℚ</a> <a id="2011" class="Symbol">→</a> <a id="2013" class="Symbol">(</a><a id="2014" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a> <a id="2016" href="Data.Sigma.Base.html#455" class="Function Operator">×</a> <a id="2018" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a><a id="2019" class="Symbol">)</a>
<a id="2021" href="Data.Rational.SternBrocot.html#1998" class="Function">fraction</a> <a id="2030" class="Symbol">=</a> <a id="2032" href="Data.Bits.Fold.html#199" class="Function">foldr-bits</a> <a id="2043" href="Data.Rational.SternBrocot.html#1888" class="Function">zer</a> <a id="2047" href="Data.Rational.SternBrocot.html#1943" class="Function">one</a> <a id="2051" class="Symbol">(</a><a id="2052" class="Number">0</a> <a id="2054" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="2056" class="Number">0</a><a id="2057" class="Symbol">)</a>

<a id="⟦_⇓⟧"></a><a id="2060" href="Data.Rational.SternBrocot.html#2060" class="Function Operator">⟦_⇓⟧</a> <a id="2065" class="Symbol">:</a> <a id="2067" href="Data.Rational.SternBrocot.html#1673" class="Function">ℚ</a> <a id="2069" class="Symbol">→</a> <a id="2071" href="Data.Rational.Unnormalised.html#274" class="Record">F.ℚ</a>
<a id="2075" href="Data.Rational.SternBrocot.html#2060" class="Function Operator">⟦</a> <a id="2077" href="Data.Rational.SternBrocot.html#198" class="InductiveConstructor">1ℚ</a> <a id="2080" href="Data.Rational.SternBrocot.html#2060" class="Function Operator">⇓⟧</a> <a id="2083" class="Symbol">=</a> <a id="2085" href="Data.Integer.html#221" class="InductiveConstructor">⁺</a> <a id="2087" class="Number">0</a> <a id="2089" href="Data.Rational.Unnormalised.html#303" class="InductiveConstructor Operator">F./suc</a> <a id="2096" class="Number">0</a>
<a id="2098" href="Data.Rational.SternBrocot.html#2060" class="Function Operator">⟦</a> <a id="2100" href="Data.Rational.SternBrocot.html#209" class="InductiveConstructor">lℚ</a> <a id="2103" href="Data.Rational.SternBrocot.html#2103" class="Bound">xs</a> <a id="2106" href="Data.Rational.SternBrocot.html#2060" class="Function Operator">⇓⟧</a> <a id="2109" class="Symbol">=</a> <a id="2111" class="Keyword">let</a> <a id="2115" href="Data.Rational.SternBrocot.html#2115" class="Bound">n</a> <a id="2117" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="2119" href="Data.Rational.SternBrocot.html#2119" class="Bound">d</a> <a id="2121" class="Symbol">=</a> <a id="2123" href="Data.Rational.SternBrocot.html#1998" class="Function">fraction</a> <a id="2132" href="Data.Rational.SternBrocot.html#2103" class="Bound">xs</a> <a id="2135" class="Keyword">in</a> <a id="2138" href="Data.Integer.html#235" class="InductiveConstructor">⁻suc</a> <a id="2143" href="Data.Rational.SternBrocot.html#2115" class="Bound">n</a> <a id="2145" href="Data.Rational.Unnormalised.html#303" class="InductiveConstructor Operator">/suc</a> <a id="2150" href="Data.Rational.SternBrocot.html#2119" class="Bound">d</a>
<a id="2152" href="Data.Rational.SternBrocot.html#2060" class="Function Operator">⟦</a> <a id="2154" href="Data.Rational.SternBrocot.html#220" class="InductiveConstructor">rℚ</a> <a id="2157" href="Data.Rational.SternBrocot.html#2157" class="Bound">xs</a> <a id="2160" href="Data.Rational.SternBrocot.html#2060" class="Function Operator">⇓⟧</a> <a id="2163" class="Symbol">=</a> <a id="2165" class="Keyword">let</a> <a id="2169" href="Data.Rational.SternBrocot.html#2169" class="Bound">n</a> <a id="2171" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="2173" href="Data.Rational.SternBrocot.html#2173" class="Bound">d</a> <a id="2175" class="Symbol">=</a> <a id="2177" href="Data.Rational.SternBrocot.html#1998" class="Function">fraction</a> <a id="2186" href="Data.Rational.SternBrocot.html#2157" class="Bound">xs</a> <a id="2189" class="Keyword">in</a> <a id="2192" href="Data.Integer.html#221" class="InductiveConstructor">⁺</a> <a id="2194" class="Symbol">(</a><a id="2195" href="Agda.Builtin.Nat.html#234" class="InductiveConstructor">suc</a> <a id="2199" href="Data.Rational.SternBrocot.html#2169" class="Bound">n</a><a id="2200" class="Symbol">)</a> <a id="2202" href="Data.Rational.Unnormalised.html#303" class="InductiveConstructor Operator">/suc</a> <a id="2207" href="Data.Rational.SternBrocot.html#2173" class="Bound">d</a>

<a id="⟦_⇑⟧"></a><a id="2210" href="Data.Rational.SternBrocot.html#2210" class="Function Operator">⟦_⇑⟧</a> <a id="2215" class="Symbol">:</a> <a id="2217" href="Data.Rational.Unnormalised.html#274" class="Record">F.ℚ</a> <a id="2221" class="Symbol">→</a> <a id="2223" href="Data.Rational.SternBrocot.html#1673" class="Function">ℚ</a>
<a id="2225" href="Data.Rational.SternBrocot.html#2210" class="Function Operator">⟦</a> <a id="2227" href="Data.Integer.html#221" class="InductiveConstructor">⁺</a> <a id="2229" href="Agda.Builtin.Nat.html#221" class="InductiveConstructor">zero</a> <a id="2234" href="Data.Rational.Unnormalised.html#303" class="InductiveConstructor Operator">/suc</a> <a id="2239" href="Data.Rational.SternBrocot.html#2239" class="Bound">den-pred</a> <a id="2248" href="Data.Rational.SternBrocot.html#2210" class="Function Operator">⇑⟧</a> <a id="2251" class="Symbol">=</a> <a id="2253" href="Data.Rational.SternBrocot.html#198" class="InductiveConstructor">1ℚ</a>
<a id="2256" href="Data.Rational.SternBrocot.html#2210" class="Function Operator">⟦</a> <a id="2258" href="Data.Integer.html#221" class="InductiveConstructor">⁺</a> <a id="2260" class="Symbol">(</a><a id="2261" href="Agda.Builtin.Nat.html#234" class="InductiveConstructor">suc</a> <a id="2265" href="Data.Rational.SternBrocot.html#2265" class="Bound">x</a><a id="2266" class="Symbol">)</a> <a id="2268" href="Data.Rational.Unnormalised.html#303" class="InductiveConstructor Operator">/suc</a> <a id="2273" href="Data.Rational.SternBrocot.html#2273" class="Bound">den-pred</a> <a id="2282" href="Data.Rational.SternBrocot.html#2210" class="Function Operator">⇑⟧</a> <a id="2285" class="Symbol">=</a> <a id="2287" href="Data.Rational.SternBrocot.html#220" class="InductiveConstructor">rℚ</a> <a id="2290" class="Symbol">(</a><a id="2291" href="Data.Rational.SternBrocot.html#1601" class="Function">normalise-suc</a> <a id="2305" href="Data.Rational.SternBrocot.html#2265" class="Bound">x</a> <a id="2307" href="Data.Rational.SternBrocot.html#2273" class="Bound">den-pred</a><a id="2315" class="Symbol">)</a>
<a id="2317" href="Data.Rational.SternBrocot.html#2210" class="Function Operator">⟦</a> <a id="2319" href="Data.Integer.html#235" class="InductiveConstructor">⁻suc</a> <a id="2324" href="Data.Rational.SternBrocot.html#2324" class="Bound">x</a> <a id="2326" href="Data.Rational.Unnormalised.html#303" class="InductiveConstructor Operator">/suc</a> <a id="2331" href="Data.Rational.SternBrocot.html#2331" class="Bound">den-pred</a> <a id="2340" href="Data.Rational.SternBrocot.html#2210" class="Function Operator">⇑⟧</a> <a id="2343" class="Symbol">=</a> <a id="2345" href="Data.Rational.SternBrocot.html#209" class="InductiveConstructor">lℚ</a> <a id="2348" class="Symbol">(</a><a id="2349" href="Data.Rational.SternBrocot.html#1601" class="Function">normalise-suc</a> <a id="2363" href="Data.Rational.SternBrocot.html#2324" class="Bound">x</a> <a id="2365" href="Data.Rational.SternBrocot.html#2331" class="Bound">den-pred</a><a id="2373" class="Symbol">)</a>

<a id="2376" class="Comment">-- open import Path.Reasoning</a>

<a id="2407" class="Comment">-- n≢sn+d : ∀ n d → (n ℕ.≡ᴮ suc (n ℕ.+ d)) ≡ false</a>
<a id="2458" class="Comment">-- n≢sn+d zero d = refl</a>
<a id="2482" class="Comment">-- n≢sn+d (suc n) d = n≢sn+d n d</a>

<a id="2516" class="Comment">-- n&lt;sn+d : ∀ n d → (n ℕ.&lt;ᴮ suc (n ℕ.+ d)) ≡ true</a>
<a id="2566" class="Comment">-- n&lt;sn+d zero d = refl</a>
<a id="2590" class="Comment">-- n&lt;sn+d (suc n) d = n&lt;sn+d n d</a>

<a id="2624" class="Comment">-- n+d-n≡d : ∀ n d → n ℕ.+ d ℕ.∸ n ≡ d</a>
<a id="2663" class="Comment">-- n+d-n≡d zero d = refl</a>
<a id="2688" class="Comment">-- n+d-n≡d (suc n) d = n+d-n≡d n d</a>

<a id="2724" class="Comment">-- euclidian-term-helper : ∀ n d s₁ s₂ → (n ℕ.+ d ℕ.≤ s₁) → (n ℕ.+ d ℕ.≤ s₂) → euclidian n d s₁ ≡ euclidian n d s₂</a>
<a id="2839" class="Comment">-- euclidian-term-helper zero zero zero zero p₁ p₂ = refl</a>
<a id="2897" class="Comment">-- euclidian-term-helper zero zero zero (suc s₂) p₁ p₂ = refl</a>
<a id="2959" class="Comment">-- euclidian-term-helper zero zero (suc s₁) zero p₁ p₂ = refl</a>
<a id="3021" class="Comment">-- euclidian-term-helper zero zero (suc s₁) (suc s₂) p₁ p₂ = refl</a>
<a id="3087" class="Comment">-- euclidian-term-helper zero (suc d) (suc s₁) (suc s₂) p₁ p₂ = cong lℚ (euclidian-term-helper zero d s₁ s₂ (ℕ.p≤p d s₁ p₁) (ℕ.p≤p d s₂ p₂))</a>
<a id="3228" class="Comment">-- euclidian-term-helper (suc n) zero (suc s₁) (suc s₂) p₁ p₂ = cong rℚ (euclidian-term-helper n zero s₁ s₂ (ℕ.p≤p (n ℕ.+ zero) s₁ p₁) (ℕ.p≤p (n ℕ.+ zero) s₂ p₂))</a>
<a id="3391" class="Comment">-- euclidian-term-helper (suc n) (suc d) (suc s₁) (suc s₂) p₁ p₂ with n ℕ.≡ᴮ d | n ℕ.&lt;ᴮ d</a>
<a id="3481" class="Comment">-- euclidian-term-helper (suc n) (suc d) (suc s₁) (suc s₂) p₁ p₂ | false | false = cong rℚ (euclidian-term-helper (n ℕ.∸ suc d) (suc d) s₁ s₂ {!!} {!!})</a>
<a id="3634" class="Comment">-- euclidian-term-helper (suc n) (suc d) (suc s₁) (suc s₂) p₁ p₂ | false | true  = cong lℚ (euclidian-term-helper (suc n) (d ℕ.∸ suc n) s₁ s₂ {!!} {!!})</a>
<a id="3787" class="Comment">-- euclidian-term-helper (suc n) (suc d) (suc s₁) (suc s₂) p₁ p₂ | true  | _ = refl</a>

<a id="3872" class="Comment">-- norm-l : ∀ n d → normalise-suc n (suc n ℕ.+ d) ≡ lℚ (normalise-suc n d)</a>
<a id="3947" class="Comment">-- norm-l n d =</a>
<a id="3963" class="Comment">--   normalise-suc n (suc n ℕ.+ d) ≡⟨⟩</a>
<a id="4002" class="Comment">--   euclidian n (suc n ℕ.+ d) (n ℕ.+ (suc n ℕ.+ d)) ≡⟨ cong (euclidian n (suc n ℕ.+ d)) (ℕ.+-suc n (n ℕ.+ d)) ⟩</a>
<a id="4115" class="Comment">--   euclidian n (suc n ℕ.+ d) (suc n ℕ.+ (n ℕ.+ d)) ≡⟨⟩</a>
<a id="4172" class="Comment">--   (if n ℕ.≡ᴮ suc (n ℕ.+ d) then 1ℚ else</a>
<a id="4215" class="Comment">--        if n ℕ.&lt;ᴮ suc (n ℕ.+ d) then lℚ (euclidian n (n ℕ.+ d ℕ.∸ n) (n ℕ.+ (n ℕ.+ d))) else rℚ (euclidian (n ℕ.∸ suc (suc (n ℕ.+ d))) (suc (n ℕ.+ d)) (n ℕ.+ (n ℕ.+ d)))) ≡⟨ cong (if_then 1ℚ else if n ℕ.&lt;ᴮ suc (n ℕ.+ d) then lℚ (euclidian n (n ℕ.+ d ℕ.∸ n) (n ℕ.+ (n ℕ.+ d))) else rℚ (euclidian (n ℕ.∸ suc (suc (n ℕ.+ d))) (suc (n ℕ.+ d)) (n ℕ.+ (n ℕ.+ d)))) (n≢sn+d n d) ⟩</a>
<a id="4591" class="Comment">--   (if n ℕ.&lt;ᴮ suc (n ℕ.+ d) then</a>
<a id="4626" class="Comment">--        lℚ (euclidian n (n ℕ.+ d ℕ.∸ n) (n ℕ.+ (n ℕ.+ d))) else</a>
<a id="4692" class="Comment">--        rℚ (euclidian (n ℕ.∸ suc (suc (n ℕ.+ d))) (suc (n ℕ.+ d)) (n ℕ.+ (n ℕ.+ d)))) ≡⟨ cong (if_then lℚ ((euclidian n (n ℕ.+ d ℕ.∸ n) (n ℕ.+ (n ℕ.+ d)))) else rℚ ((euclidian (n ℕ.∸ suc (suc (n ℕ.+ d))) (suc (n ℕ.+ d)) (n ℕ.+ (n ℕ.+ d))))) (n&lt;sn+d n d) ⟩</a>
<a id="4950" class="Comment">--   lℚ (euclidian n (n ℕ.+ d ℕ.∸ n) (n ℕ.+ (n ℕ.+ d))) ≡⟨ cong (λ ndn → lℚ (euclidian n ndn (n ℕ.+ (n ℕ.+ d)))) (n+d-n≡d n d) ⟩</a>
<a id="5079" class="Comment">--   lℚ (euclidian n d (n ℕ.+ (n ℕ.+ d))) ≡⟨ {!!} ⟩</a>
<a id="5131" class="Comment">--   lℚ (euclidian n d (n ℕ.+ d)) ≡⟨⟩</a>
<a id="5169" class="Comment">--   lℚ (normalise-suc n d) ∎</a>


<a id="5201" class="Comment">-- ℚ-retract′ : ∀ x → normalise-suc (fst (fraction x)) (snd (fraction x)) ≡ x</a>
<a id="5279" class="Comment">-- ℚ-retract′ 1ℚ = refl</a>
<a id="5303" class="Comment">-- ℚ-retract′ (rℚ x) = {!!}</a>
<a id="5331" class="Comment">-- ℚ-retract′ (lℚ x) = let n , d = fraction x in</a>
<a id="5380" class="Comment">--   normalise-suc n (suc (n ℕ.+ d)) ≡⟨ {!!} ⟩</a>
<a id="5427" class="Comment">--   lℚ x ∎</a>

<a id="5440" class="Comment">-- ℚ-retract : ∀ x → ⟦ ⟦ x ⇓⟧ ⇑⟧ ≡ x</a>
<a id="5477" class="Comment">-- ℚ-retract 1ℚ = refl</a>
<a id="5500" class="Comment">-- ℚ-retract (lℚ x) = cong lℚ (ℚ-retract′ x)</a>
<a id="5545" class="Comment">-- ℚ-retract (rℚ x) = cong rℚ (ℚ-retract′ x)</a>
</pre></body></html>